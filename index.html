<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>M.O.G. | NATIONAL GRID MASTER V180.19</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        @import url('https://api.fontshare.com/v2/css?f[]=clash-display@700&f[]=satoshi@400,900&display=swap');
        
        :root { 
            --mog-gold: #D4AF37; --mog-blue: #00d4ff; --mog-bg: #060a0f; 
            --mog-panel: rgba(10, 20, 30, 0.95); --chat-sent: #005c4b; --chat-received: #202c33; 
        }

        * { transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); font-family: 'Satoshi', sans-serif; box-sizing: border-box; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--mog-blue); border-radius: 10px; }

        body { 
            background-color: var(--mog-bg);
            background-image: radial-gradient(circle at 2px 2px, rgba(0, 212, 255, 0.05) 1px, transparent 0);
            background-size: 30px 30px;
            color: var(--mog-gold); min-height: 100vh; margin: 0; padding-bottom: 2rem; overflow-x: hidden;
        }

        .mainframe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 400px), 1fr));
            gap: 1.5rem; width: 100%; padding: 1.5rem;
        }

        .command-tile { 
            background: var(--mog-panel); border: 1px solid rgba(0, 212, 255, 0.1); 
            backdrop-filter: blur(50px); border-radius: 35px; overflow: hidden; 
            display: flex; flex-direction: column; height: 100%; 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
        }

        .full-width { grid-column: 1 / -1; }

        /* SCROLLERS & EVENTS */
        .scroller-x { display: flex; overflow-x: auto; gap: 15px; padding: 10px; scroll-snap-type: x mandatory; }
        .scroll-item { min-width: 280px; border-radius: 25px; overflow: hidden; scroll-snap-align: start; flex-shrink: 0; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05); }
        .event-card { background: rgba(0, 212, 255, 0.05); border-left: 4px solid var(--mog-blue); padding: 15px; border-radius: 15px; }

        .messenger-view { height: 550px; display: flex; flex-direction: column; background: #0b141a; }
        .msg-stream { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .bubble { max-width: 80%; padding: 14px 18px; border-radius: 22px; font-size: 14px; position: relative; }
        .sent { align-self: flex-end; background: var(--chat-sent); color: #fff; border-bottom-right-radius: 4px; }
        .received { align-self: flex-start; background: var(--chat-received); color: #e9edef; border-bottom-left-radius: 4px; }

        #announcement-bar { position: fixed; top: -100px; left: 0; width: 100%; padding: 18px; background: #ff0050; color: white; z-index: 10000; display: flex; align-items: center; justify-content: center; font-weight: 900; text-transform: uppercase; box-shadow: 0 15px 30px rgba(255,0,80,0.3); }
        .announcement-active { top: 0 !important; }

        .modal-overlay { position: fixed; inset: 0; z-index: 9999; background: rgba(0,0,0,0.98); backdrop-filter: blur(30px); display: none; align-items: center; justify-content: center; padding: 1rem; }
        .active-modal { display: flex !important; }

        input, select { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 16px; border-radius: 20px; outline: none; width: 100%; }
        .vibe-tag { font-size: 10px; background: rgba(0, 212, 255, 0.15); color: var(--mog-blue); padding: 4px 10px; border-radius: 10px; font-weight: 900; }
    </style>
</head>
<body id="mog-mainframe">

    <audio id="log-drum" src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logdrum.mp3" preload="auto"></audio>

    <div id="announcement-bar">
        <i class="fa-solid fa-tower-broadcast mr-3 animate-pulse"></i> <span id="announcement-text">Broadcasting...</span>
    </div>

    <div id="director-console" class="modal-overlay">
        <div class="command-tile p-8 max-w-6xl w-full max-h-[85vh] overflow-y-auto border-gold/30">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-3xl text-white font-black uppercase italic">Director Oversight v19</h2>
                <button onclick="toggleUI('director-console')" class="bg-white/10 p-3 rounded-full text-zinc-400 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="space-y-6">
                    <p class="text-[10px] text-blue-400 font-black uppercase">Signal Center</p>
                    <input type="text" id="dir-announce" placeholder="Global Message">
                    <button onclick="pushAnnouncement()" class="w-full bg-[#ff0050] text-white font-black py-4 rounded-xl text-xs uppercase">Broadcast</button>
                    <input type="text" id="dir-yt-id" placeholder="YouTube ID" class="mt-4">
                    <button onclick="updateBroadcast()" class="w-full bg-blue-500 text-black font-black py-4 rounded-xl text-xs uppercase">Sync Signal</button>
                </div>
                <div class="space-y-6">
                    <p class="text-[10px] text-blue-400 font-black uppercase">Event Manager</p>
                    <input type="text" id="dir-event-title" placeholder="Event Name">
                    <input type="date" id="dir-event-date">
                    <button onclick="addGridEvent()" class="w-full bg-white text-black font-black py-4 rounded-xl text-xs uppercase">Post Event</button>
                    <div id="director-event-list" class="space-y-2 max-h-40 overflow-y-auto mt-4"></div>
                </div>
                <div class="space-y-6">
                    <p class="text-[10px] text-blue-400 font-black uppercase">Grid Requests</p>
                    <div id="director-request-list" class="space-y-3 max-h-80 overflow-y-auto text-[10px] font-black uppercase text-white"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed top-0 w-full bg-black z-[9000] h-[45px] border-b border-blue-400/20 flex items-center overflow-hidden">
        <div class="ticker-move text-[10px] font-black uppercase text-blue-400">
            M.O.G. V19 // GOOGLE_OAUTH_INTEGRATED // EVENTS_MATRIX_LIVE // LEADERBOARD_SYNCED // SECURE_S01_TUNNEL...
        </div>
    </div>

    <div class="max-w-[1600px] mx-auto mt-20 px-4">
        <header class="flex items-center justify-between p-6 mb-8">
            <div class="flex items-center gap-6">
                <img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" id="mog-logo-trigger" class="h-20 w-20 cursor-pointer">
                <h1 class="text-4xl lg:text-7xl text-gold font-black uppercase italic tracking-tighter">Ministry of Groove</h1>
            </div>
        </header>

        <div class="mainframe-grid">
            
            <section class="command-tile p-8">
                <div id="auth-container">
                    <h3 class="text-white font-black uppercase text-[11px] mb-6 italic tracking-widest border-b border-white/5 pb-4">Grid Authorization</h3>
                    <button onclick="loginWithGoogle()" class="w-full bg-white text-black font-black py-4 rounded-full uppercase text-xs flex items-center justify-center gap-3 mb-6">
                        <i class="fa-brands fa-google"></i> Sign in with Google
                    </button>
                    <div class="flex items-center gap-4 mb-6 opacity-30"><hr class="flex-grow border-white/20"> <span class="text-[10px] font-black uppercase">OR</span> <hr class="flex-grow border-white/20"></div>
                    <div id="reg-fields" class="hidden mb-4"><input id="reg-alias" type="text" placeholder="CHOOSE ALIAS"></div>
                    <input id="auth-user" type="text" class="mb-3" placeholder="GMAIL / EMAIL">
                    <input id="auth-pass" type="password" class="mb-6" placeholder="PASSCODE">
                    <div class="flex gap-4">
                        <button onclick="setAuthMode('login')" id="btn-login" class="flex-1 text-[10px] font-black text-blue-400 uppercase">Login</button>
                        <button onclick="executeAuth()" id="auth-btn" class="flex-grow bg-blue-500 text-black font-black py-4 rounded-xl uppercase text-xs">Authorize</button>
                        <button onclick="setAuthMode('reg')" id="btn-reg" class="flex-1 text-[10px] font-black text-zinc-500 uppercase text-right">Join</button>
                    </div>
                </div>
                <div id="active-op-badge" class="hidden flex flex-col items-center justify-center text-center">
                    <img id="display-avatar" src="" class="w-24 h-24 rounded-3xl border-2 border-gold cursor-pointer object-cover mb-4" onclick="toggleUI('profile-modal')">
                    <h2 id="display-op-id" class="text-2xl text-white font-black uppercase italic mb-2">OPERATIVE</h2>
                    <span class="vibe-tag" id="display-vibe">VIBE_SYNCING...</span>
                </div>
            </section>

            <section class="command-tile p-8">
                <h3 class="text-white font-black uppercase text-[11px] mb-6 italic tracking-widest">Grid Events</h3>
                <div id="events-matrix" class="space-y-4 overflow-y-auto max-h-[300px] pr-2">
                    </div>
            </section>

            <section class="command-tile p-2 aspect-video lg:col-span-2">
                <div id="yt-broadcast" class="w-full h-full bg-black rounded-[30px] overflow-hidden"></div>
            </section>

            <section class="command-tile p-8">
                <h3 class="text-white font-black uppercase text-[11px] mb-8 italic border-b border-white/5 pb-4">Top 10 Hitlist</h3>
                <div id="dynamic-poll" class="space-y-4 overflow-y-auto max-h-[400px]"></div>
            </section>

            <section class="command-tile p-6">
                <h3 class="text-white font-black uppercase text-[11px] mb-4 italic tracking-widest">Sector Radar</h3>
                <iframe src="http://googleusercontent.com/maps.google.com/9" width="100%" height="100%" class="min-h-[250px]" loading="lazy"></iframe>
            </section>

            <section class="command-tile p-1 full-width">
                <div class="messenger-view rounded-[34px]">
                    <div class="bg-[#202c33] p-5 flex flex-wrap justify-between items-center gap-4">
                        <div class="flex gap-4">
                            <button onclick="switchChat('public')" id="tab-public" class="text-[10px] font-black uppercase px-6 py-2 bg-blue-500 text-black rounded-lg">Public</button>
                            <button onclick="switchChat('private')" id="tab-private" class="text-[10px] font-black uppercase px-6 py-2 bg-white/5 text-zinc-500 rounded-lg">Direct</button>
                        </div>
                        <input type="text" id="chat-search" class="hidden bg-black/40 text-xs py-2 px-4 rounded-xl border-blue-400/20" placeholder="Filter..." onkeyup="filterMessages()">
                    </div>
                    <div id="chat-stream" class="msg-stream"></div>
                    <div class="bg-[#202c33] p-5 flex gap-4">
                        <input id="chat-msg" type="text" class="flex-grow bg-[#2a3942] border-0 rounded-full px-8 py-5 text-white outline-none" placeholder="Transmit packet...">
                        <button onclick="sendMessage()" class="w-16 h-16 bg-blue-500 text-black rounded-full flex items-center justify-center"><i class="fa-solid fa-paper-plane"></i></button>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <script>
        const MOG_CFG = {
            U: "https://hzelmkthdqtbÑxffsstl.supabase.co",
            K: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh6ZWxta3RoZHF0YmN4ZmZzc3RsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MDExOTksImV4cCI6MjA4NzM3NzE5OX0.Hx-dlAnPYqn-1GAmkS0ZNJIuvhutYdJ2_fLxAn3MTfY"
        };
        const db = window.supabase.createClient(MOG_CFG.U, MOG_CFG.K);
        let currentOp = null, authMode = 'login', logoClicks = 0, currentChatTab = 'public';

        /* --- SYNC ENGINE --- */
        const channel = db.channel('mog-v19');
        channel.on('broadcast', { event: 'announcement' }, p => triggerAnnouncement(p.payload.msg))
            .on('postgres_changes', { event: '*', schema: 'public', table: 'messages' }, () => refreshChat())
            .on('postgres_changes', { event: '*', schema: 'public', table: 'events' }, () => fetchEvents())
            .subscribe(async (s) => { if (s === 'SUBSCRIBED' && currentOp) await channel.track({ user_id: currentOp.id }); });

        /* --- GOOGLE LOGIN --- */
        async function loginWithGoogle() {
            const { error } = await db.auth.signInWithOAuth({ provider: 'google' });
            if(error) alert(error.message);
        }

        /* --- AUTH & DNA --- */
        function setAuthMode(m) { authMode = m; document.getElementById('reg-fields').classList.toggle('hidden', m === 'login'); }
        async function executeAuth() {
            const e = document.getElementById('auth-user').value.trim();
            const p = document.getElementById('auth-pass').value;
            if(authMode === 'reg') {
                const { data } = await db.auth.signUp({ email: e, password: p });
                if(data.user) await db.from('registrations').insert([{ user_id: data.user.id, alias: document.getElementById('reg-alias').value.trim() }]);
                setAuthMode('login');
            } else {
                const { data, error } = await db.auth.signInWithPassword({ email: e, password: p });
                if(data.user) setupSession(data.user); else alert(error.message);
            }
        }

        async function setupSession(u) {
            currentOp = u; document.getElementById('auth-container').classList.add('hidden'); document.getElementById('active-op-badge').classList.remove('hidden');
            const { data } = await db.from('registrations').select('*').eq('user_id', u.id).single();
            if(data) {
                document.getElementById('display-op-id').innerText = data.alias;
                document.getElementById('display-avatar').src = data.avatar_url || 'https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png';
                document.getElementById('display-vibe').innerText = data.status || 'READY';
            }
            syncGrid(); fetchEvents(); refreshChat();
        }

        /* --- EVENTS MATRIX --- */
        async function fetchEvents() {
            const { data } = await db.from('events').select('*').order('date', { ascending: true });
            document.getElementById('events-matrix').innerHTML = data?.map(ev => `
                <div class="event-card">
                    <p class="text-[8px] font-black text-blue-400 uppercase">${new Date(ev.date).toDateString()}</p>
                    <p class="text-xs font-black uppercase text-white">${ev.title}</p>
                </div>`).join('') || '<p class="text-[10px] opacity-30">No upcoming events.</p>';
            
            document.getElementById('director-event-list').innerHTML = data?.map(ev => `
                <div class="flex justify-between text-[10px] bg-white/5 p-2 rounded">
                    <span>${ev.title}</span> <button onclick="deleteEvent('${ev.id}')" class="text-red-500">X</button>
                </div>`).join('');
        }

        async function addGridEvent() {
            const title = document.getElementById('dir-event-title').value;
            const date = document.getElementById('dir-event-date').value;
            await db.from('events').insert([{ title, date }]); fetchEvents();
        }

        async function deleteEvent(id) { await db.from('events').delete().eq('id', id); fetchEvents(); }

        /* --- UTILS & BROADCAST --- */
        async function syncGrid() {
            const { data } = await db.from('broadcast').select('*').eq('id', 1).single();
            if(data) document.getElementById('yt-broadcast').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${data.youtube_id}" frameborder="0" allowfullscreen></iframe>`;
        }

        async function pushAnnouncement() {
            const msg = document.getElementById('dir-announce').value;
            await channel.send({ type: 'broadcast', event: 'announcement', payload: { msg } });
            document.getElementById('dir-announce').value = '';
        }

        function triggerAnnouncement(msg) {
            const bar = document.getElementById('announcement-bar');
            document.getElementById('announcement-text').innerText = msg;
            bar.classList.add('announcement-active'); document.getElementById('log-drum').play().catch(()=>{});
            setTimeout(() => bar.classList.remove('announcement-active'), 8000);
        }

        /* --- LOGO TRIGGER --- */
        document.getElementById('mog-logo-trigger').addEventListener('click', () => {
            logoClicks++;
            if(logoClicks === 5) { 
                if(currentOp?.email === 'director.mog@gmail.com') {
                    const pass = prompt("DIRECTOR_PROTOCOL_ID:");
                    if(pass === "@MOGProtocol2026") toggleUI('director-console');
                }
                logoClicks = 0; 
            }
            setTimeout(() => logoClicks = 0, 5000);
        });

        function toggleUI(id) { document.getElementById(id).classList.toggle('active-modal'); }
        window.onload = () => { if(currentOp) syncGrid(); };
    </script>
</body>
</html>
