<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>M.O.G. | SOVEREIGN TOTALITY v101.4.0</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tenor+Sans&family=Big+Shoulders+Display:wght@900&family=JetBrains+Mono:wght@300;700;800&family=Inter:wght@300;400;600;800&display=swap');
        
        :root { 
            --mog-gold: #D4AF37; --mog-blue: #00d4ff; --mog-black: #050505; 
            --mog-glass: rgba(5, 12, 20, 0.98); --mog-border: rgba(212, 175, 55, 0.3);
        }

        html, body { min-height: 100vh; width: 100vw; margin: 0; padding: 0; overflow-x: hidden; background-color: var(--mog-black); color: var(--mog-gold); }
        * { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); font-family: 'Inter', sans-serif; box-sizing: border-box; }
        h1, h2, .tile-title { font-family: 'Tenor Sans', sans-serif !important; letter-spacing: 3px; text-transform: uppercase; }

        /* NEURAL LIGHTNING */
        #lightning-canvas { position: fixed; inset: 0; z-index: -2; opacity: 0.3; pointer-events: none; }
        #bg-canvas { position: fixed; inset: 0; z-index: -1; opacity: 0.5; background-image: radial-gradient(circle at 50% 50%, rgba(0, 212, 255, 0.1) 0%, transparent 80%), url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0 L30 30 M60 0 L30 30' stroke='%2300d4ff' stroke-width='0.5' fill='none' opacity='0.1'/%3E%3C/svg%3E"); }

        /* CIRCULAR SPLASH */
        #splash-screen { position: fixed; inset: 0; z-index: 99999; background: var(--mog-black); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .splash-logo-container { width: 180px; height: 180px; clip-path: circle(50% at 50% 50%); border: 2px solid var(--mog-gold); animation: pulse-glow 2s infinite alternate; }
        @keyframes pulse-glow { from { transform: scale(0.95); } to { transform: scale(1.05); box-shadow: 0 0 60px rgba(0, 212, 255, 0.4); } }

        /* UI MONOLITH */
        .command-tile { background: var(--mog-glass); border: 1px solid var(--mog-border); border-radius: 2px; backdrop-filter: blur(30px); box-shadow: 0 20px 60px rgba(0,0,0,1); }
        .tile-header { border-bottom: 1px solid rgba(212, 175, 55, 0.1); padding: 16px 20px; background: linear-gradient(90deg, rgba(212, 175, 55, 0.05) 0%, transparent 100%); display: flex; justify-content: space-between; align-items: center; }
        
        .mog-input { background: #000 !important; border: 1px solid rgba(0, 212, 255, 0.2) !important; color: var(--mog-blue) !important; padding: 14px; width: 100%; outline: none; font-size: 0.85rem; font-family: 'JetBrains Mono'; }
        .mog-btn { border: 1px solid var(--mog-gold); color: var(--mog-gold); padding: 14px 28px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; cursor: pointer; background: transparent; letter-spacing: 3px; }
        .mog-btn:hover { background: var(--mog-gold); color: #000; box-shadow: 0 0 40px var(--mog-gold); }

        /* UPGRADED MAP SCANNER */
        .map-container { position: relative; height: 300px; width: 100%; overflow: hidden; border: 1px solid rgba(0, 212, 255, 0.2); }
        .map-overlay { position: absolute; inset: 0; pointer-events: none; background: linear-gradient(transparent 90%, var(--mog-blue) 100%); background-size: 100% 40px; animation: map-scan 4s linear infinite; opacity: 0.2; }
        @keyframes map-scan { from { transform: translateY(-100%); } to { transform: translateY(1000%); } }

        /* DUAL GATE OTP */
        .otp-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 10px; margin: 30px 0; }
        .otp-box { background: #000; border: 1px solid var(--mog-blue); color: #fff; text-align: center; height: 50px; font-family: 'JetBrains Mono'; font-weight: 800; font-size: 1.2rem; outline: none; }

        footer { position: fixed; bottom: 40px; left: 0; width: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); padding: 15px 0; z-index: 900; }
        .social-link { font-size: 1.4rem; color: var(--mog-gold); transition: 0.4s; }
        #event-ticker { position: fixed; bottom: 0; left: 0; width: 100%; height: 40px; background: #000; border-top: 1px solid var(--mog-gold); z-index: 1000; display: flex; align-items: center; overflow: hidden; }
        #ticker-content { white-space: nowrap; animation: ticker-scroll 45s linear infinite; font-size: 11px; color: var(--mog-blue); font-weight: 600; padding-left: 20px; }
        @keyframes ticker-scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
    </style>
</head>
<body id="mog-totality">

    <canvas id="lightning-canvas"></canvas>
    <div id="splash-screen"><div class="splash-logo-container"><img src="logo.png" class="w-full h-full object-cover"></div></div>
    <div id="bg-canvas"></div>

    <header class="p-10 flex flex-col lg:flex-row justify-between items-center relative z-50 gap-8">
        <div class="flex items-center gap-8">
            <img src="logo.png" onclick="handleLogoSequence()" class="h-20 w-20 border-2 border-gold rounded-full shadow-2xl cursor-pointer">
            <div>
                <h1 class="text-3xl font-normal text-white italic tracking-[.25em]">MINISTRY OF GROOVE</h1>
                <p class="text-[10px] text-blue-400 tracking-[.5em] mt-2 uppercase font-black">Sovereign Monolith v101.4.0</p>
            </div>
        </div>
        <div id="auth-status" class="text-[10px] text-red-500 font-bold border border-red-900 px-6 py-2 bg-red-950/20 tracking-[.3em] uppercase italic">Gated Access</div>
    </header>

    <main class="p-6 lg:p-10 relative z-50 min-h-[70vh]">
        
        <div id="gate-keeper" class="flex flex-col items-center justify-center space-y-8">
            <section id="gate-1" class="command-tile p-12 max-w-md w-full text-center">
                <h2 class="text-xl mb-8 uppercase tracking-widest">Protocol 1: Identity</h2>
                <button onclick="loginWithGoogle()" class="mog-btn w-full flex items-center justify-center gap-4">
                    <i class="fa-brands fa-google"></i> Identify via Google
                </button>
            </section>

            <section id="gate-2" class="command-tile p-12 max-w-2xl w-full text-center hidden">
                <h2 class="text-xl mb-4 uppercase tracking-widest">Protocol 2: Email Cipher</h2>
                <div class="otp-grid">
                    <input type="text" maxlength="1" class="otp-box" onkeyup="tabFocus(this, 1)">
                    <input type="text" maxlength="1" class="otp-box" onkeyup="tabFocus(this, 2)">
                    <input type="text" maxlength="1" class="otp-box" onkeyup="tabFocus(this, 3)">
                    <input type="text" maxlength="1" class="otp-box" onkeyup="tabFocus(this, 4)">
                    <input type="text" maxlength="1" class="otp-box" onkeyup="tabFocus(this, 5)">
                    <input type="text" maxlength="1" class="otp-box" onkeyup="tabFocus(this, 6)">
                    <input type="text" maxlength="1" class="otp-box" onkeyup="tabFocus(this, 7)">
                    <input type="text" maxlength="1" class="otp-box" onkeyup="tabFocus(this, 8)">
                </div>
                <button onclick="verifyCipher()" class="mog-btn w-full">Verify Signal</button>
            </section>
        </div>

        <div id="mog-totality-grid" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-10 pb-32">
            
            <div class="lg:col-span-4 space-y-10">
                <section class="command-tile">
                    <div class="tile-header">Satellite Radar Grid <i class="fa-solid fa-satellite-dish"></i></div>
                    <div class="map-container">
                        <iframe width="100%" height="100%" style="border:0; filter: grayscale(1) invert(1) contrast(1.2) opacity(0.8);" src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d14345.4!2d29.2323!3d-25.8727!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sza!4v1700000000000"></iframe>
                        <div class="map-overlay"></div>
                    </div>
                </section>

                <section class="command-tile">
                    <div class="tile-header">Amapiano Poll <i class="fa-solid fa-square-poll-vertical"></i></div>
                    <div id="poll-list" class="p-6 space-y-2 max-h-60 overflow-y-auto"></div>
                </section>
            </div>

            <div class="lg:col-span-8 space-y-10">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <section class="command-tile">
                        <div class="tile-header">Global Broadcast <i class="fa-brands fa-youtube"></i></div>
                        <div class="p-4"><div id="broadcast-frame" class="aspect-video bg-black flex items-center justify-center text-[9px] uppercase tracking-widest animate-pulse">Scanning Signal...</div></div>
                    </section>
                    <section class="command-tile">
                        <div class="tile-header">Frequency Comms <i class="fa-solid fa-message"></i></div>
                        <div id="chat-stream" class="h-40 p-4 overflow-y-auto font-mono text-[10px] space-y-2"></div>
                        <div class="p-4 flex gap-2 border-t border-white/5">
                            <input id="chat-msg-in" class="mog-input !mb-0" placeholder="TRANSMIT...">
                            <button onclick="sendPacket()" class="mog-btn !px-4">Send</button>
                        </div>
                    </section>
                </div>
                
                <section id="director-node" class="command-tile hidden !border-red-600">
                    <div class="tile-header !text-red-500">Directorate Command <i class="fa-solid fa-shield-halved"></i></div>
                    <div class="p-8 grid md:grid-cols-2 gap-8">
                        <button onclick="toggleDirectorUI()" class="mog-btn !border-red-600 !text-red-500">Vault Access</button>
                        <button onclick="document.getElementById('file-in').click()" class="mog-btn">Push Sonic Intel</button>
                        <input type="file" id="file-in" class="hidden" multiple onchange="handleUpload(this.files)">
                    </div>
                </section>
            </div>
        </div>
    </main>

    <footer>
        <div class="flex justify-center gap-12">
            <a href="https://tiktok.com/@ministryofgroove" target="_blank" class="social-link"><i class="fa-brands fa-tiktok"></i></a>
            <a href="https://www.instagram.com/ministryofgroove_hq" target="_blank" class="social-link"><i class="fa-brands fa-instagram"></i></a>
            <a href="mailto:director.mog@gmail.com" class="social-link"><i class="fa-solid fa-envelope"></i></a>
        </div>
    </footer>

    <div id="event-ticker">
        <div id="ticker-content">... SYSTEM V101.4.0 TOTALITY ... SATELLITE_RADAR ONLINE ... SQL_POLL_ENGINE READY ... DUAL_GATE_CIPHER ACTIVE ...</div>
    </div>

    <section id="director-dashboard" class="hidden fixed inset-0 z-[11000] bg-black/98 p-10 backdrop-blur-3xl overflow-y-auto">
        <div class="max-w-4xl mx-auto space-y-12">
            <h2 class="text-4xl font-black italic border-b border-gold pb-4">DIRECTORATE VAULT</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="command-tile p-10 text-center"><p class="text-xs uppercase text-gold">Wealth Index</p><p id="wealth-val" class="text-5xl font-black text-white mt-4">R73,827.00</p></div>
                <div class="command-tile p-10"><p class="text-xs uppercase text-gold">Bond Yield</p><p class="text-2xl font-bold mt-4">R13,827.19</p></div>
            </div>
        </div>
    </section>

    <script>
        const CFG = { 
            U: "https://hzelmkthdqtbcxffsstl.supabase.co", 
            K: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh6ZWxta3RoZHF0YmN4ZmZzc3RsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MDExOTksImV4cCI6MjA4NzM3NzE5OX0.Hx-dlAnPYqn-1GAmkS0ZNJIuvhutYdJ2_fLxAn3MTfY",
            D: "director.mog@gmail.com"
        };
        const db = window.supabase.createClient(CFG.U, CFG.K);
        let logoClicks = 0;

        // AUTH & DUAL GATE
        db.auth.onAuthStateChange(async (event, session) => {
            if (session && event === 'SIGNED_IN') {
                document.getElementById('gate-1').classList.add('hidden');
                document.getElementById('gate-2').classList.remove('hidden');
                await db.auth.signInWithOtp({ email: session.user.email });
            }
        });

        async function loginWithGoogle() { await db.auth.signInWithOAuth({ provider: 'google', options: { redirectTo: window.location.origin } }); }
        function tabFocus(el, i) { if (el.value.length === 1 && i < 8) document.querySelectorAll('.otp-box')[i].focus(); }

        async function verifyCipher() {
            const token = Array.from(document.querySelectorAll('.otp-box')).map(i => i.value).join('');
            const { error } = await db.auth.verifyOtp({ email: (await db.auth.getUser()).data.user.email, token: token, type: 'signup' });
            if (!error) {
                document.getElementById('gate-keeper').classList.add('hidden');
                document.getElementById('mog-totality-grid').classList.remove('hidden');
                document.getElementById('auth-status').innerText = "LINK STABLE";
                document.getElementById('auth-status').className = "text-[10px] text-blue-400 font-bold border border-blue-900 px-6 py-2 bg-blue-950/20";
                syncSystem();
            }
        }

        // SYSTEM SYNC
        async function syncSystem() {
            const { data: b } = await db.from('broadcast').select('*').single();
            if (b) document.getElementById('broadcast-frame').innerHTML = `<iframe class="w-full h-full" src="https://www.youtube.com/embed/${b.youtube_id}?autoplay=1&mute=1" frameborder="0"></iframe>`;
            
            const { data: p } = await db.from('amapiano_poll').select('*');
            if (p) document.getElementById('poll-list').innerHTML = p.map(poll => `<div class="p-3 border border-white/5 flex justify-between text-[10px] font-bold" onclick="castVote('${poll.id}')"><span>${poll.track_name.toUpperCase()}</span><span class="text-blue-400">${poll.vote_count} VOTES</span></div>`).join('');

            if ((await db.auth.getUser()).data.user.email === CFG.D) document.getElementById('director-node').classList.remove('hidden');
        }

        // VISUALS
        window.onload = () => {
            initLightning();
            setTimeout(() => { document.getElementById('splash-screen').style.opacity = '0'; setTimeout(() => document.getElementById('splash-screen').style.display='none', 1000); }, 2500);
        };

        function initLightning() {
            const c = document.getElementById('lightning-canvas');
            const x = c.getContext('2d');
            let w = c.width = window.innerWidth, h = c.height = window.innerHeight;
            function a() {
                x.fillStyle = 'rgba(0,0,0,0.1)'; x.fillRect(0,0,w,h);
                if(Math.random() > 0.96) { x.strokeStyle = '#00d4ff'; x.beginPath(); let lx = Math.random()*w, ly=0; x.moveTo(lx,ly); for(let i=0;i<8;i++){ lx+=(Math.random()-0.5)*100; ly+=h/8; x.lineTo(lx,ly); } x.stroke(); }
                requestAnimationFrame(a);
            }
            a();
        }

        function toggleDirectorUI() { document.getElementById('director-dashboard').classList.toggle('hidden'); }
        function handleLogoSequence() { if (++logoClicks === 5) { const p = prompt("BYPASS_KEY:"); if(p === '7486') toggleDirectorUI(); } setTimeout(() => logoClicks = 0, 5000); }
        async function handleUpload(f) { for(const file of f) await db.storage.from('intel-vault').upload(`${Date.now()}_${file.name}`, file); alert("DEPLOYED."); }
    </script>
</body>
</html>
