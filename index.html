<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>M.O.G. | NATIONAL GRID MASTER TOTALITY V290</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        /* -----------------------------------------------------------
           1. QUANTUM THEME ENGINE
        ----------------------------------------------------------- */
        @import url('https://api.fontshare.com/v2/css?f[]=clash-display@700&f[]=satoshi@400,900&display=swap');
        
        :root { 
            --mog-gold: #D4AF37; --mog-blue: #00d4ff; --mog-bg: #060a0f; 
            --mog-panel: rgba(10, 20, 30, 0.98); --chat-sent: #005c4b; --chat-received: #202c33;
        }

        html, body { height: 100vh; margin: 0; padding: 0; overflow: hidden; background-color: var(--mog-bg); }
        * { transition: all 0.2s ease-in-out; font-family: 'Satoshi', sans-serif; box-sizing: border-box; }

        /* SCROLLER ARCHITECTURE */
        .scroller-container::-webkit-scrollbar { width: 6px; }
        .scroller-container::-webkit-scrollbar-thumb { 
            background: linear-gradient(var(--mog-blue), var(--mog-gold)); 
            border-radius: 10px;
        }

        .matrix-grid { display: grid; grid-template-columns: repeat(2, 1fr); grid-auto-rows: 140px; gap: 12px; }
        .scroller-container { height: 460px; overflow-y: scroll; padding: 10px; }

        /* HAMBURGER DRAWER */
        #side-drawer { 
            position: fixed; top: 0; left: -100%; width: 340px; height: 100%; 
            background: #0a0e14; z-index: 9999; transition: 0.5s; 
            border-right: 1px solid var(--mog-blue); box-shadow: 20px 0 50px rgba(0,0,0,0.9);
        }
        #side-drawer.drawer-active { left: 0; }
        .drawer-item { 
            padding: 15px 25px; border-bottom: 1px solid rgba(255,255,255,0.03); 
            text-transform: uppercase; font-size: 11px; font-weight: 900; color: #666;
            display: flex; align-items: center; gap: 15px; cursor: pointer;
        }
        .drawer-item:hover { background: rgba(0, 212, 255, 0.05); color: white; }
        .folder-label { font-size: 9px; color: var(--mog-gold); padding: 20px 25px 5px; text-transform: uppercase; letter-spacing: 2px; }

        .pulse-btn { 
            background: var(--mog-blue); color: #000; font-weight: 900; 
            border-radius: 50px; padding: 8px 15px; font-size: 9px; 
            text-transform: uppercase; box-shadow: 0 0 15px var(--mog-blue);
        }

        .liquid-mainframe {
            display: grid; height: calc(100vh - 80px); width: 100vw; padding: 15px; gap: 15px;
            grid-template-columns: repeat(3, 1fr);
            grid-template-areas: "gateway messenger messenger" "gallery vault hitlist";
        }

        @media (max-width: 1024px) {
            .liquid-mainframe { grid-template-columns: 1fr; grid-template-areas: "gateway" "messenger" "gallery" "hitlist" "vault"; overflow-y: auto; height: auto; }
        }

        .command-tile { background: var(--mog-panel); border: 1px solid rgba(0, 212, 255, 0.2); backdrop-filter: blur(50px); border-radius: 35px; overflow: hidden; }
        .area-gallery { grid-area: gallery; } .area-vault { grid-area: vault; } .area-hitlist { grid-area: hitlist; }

        .item-card {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.07);
            border-radius: 20px; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; text-align: center; padding: 10px;
        }

        .video-card { position: relative; width: 100%; height: 100%; overflow: hidden; border-radius: 15px; }
        .video-card video { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body id="mog-mainframe">

    <audio id="log-drum" src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logdrum.mp3" preload="auto"></audio>

    <nav id="side-drawer">
        <div class="p-8 border-b border-white/5 flex justify-between items-center">
            <img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" class="h-12 w-12">
            <button onclick="toggleDrawer()"><i class="fa-solid fa-xmark text-white"></i></button>
        </div>
        
        <div class="scroller-container h-full pb-20">
            <p class="folder-label">Mainframe Folders</p>
            <div class="drawer-item"><i class="fa-solid fa-house-chimney"></i> National Grid Home</div>
            <div class="drawer-item"><i class="fa-solid fa-id-card-clip"></i> Operative ID Matrix</div>
            
            <p class="folder-label">Mandate Files</p>
            <div class="drawer-item"><i class="fa-solid fa-file-audio"></i> Mandate Mix Archive</div>
            <div class="drawer-item"><i class="fa-solid fa-file-lines"></i> Tracklist Metadata</div>
            
            <p class="folder-label">System Ops</p>
            <div class="drawer-item" onclick="toggleUI('director-console')"><i class="fa-solid fa-user-gear"></i> Director Hub</div>
            <div class="drawer-item"><i class="fa-solid fa-shield-virus"></i> Security Protocol</div>
            <div class="drawer-item"><i class="fa-solid fa-database"></i> Supabase Realtime Sync</div>
        </div>
    </nav>

    <header class="h-[80px] px-8 flex justify-between items-center border-b border-white/5 bg-black/40">
        <div class="flex items-center gap-4">
            <button onclick="toggleDrawer()" class="text-gold text-xl mr-4"><i class="fa-solid fa-bars-staggered"></i></button>
            <img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" class="h-10 w-10">
            <div>
                <h1 class="text-lg font-black uppercase italic tracking-tighter text-gold">Ministry of Groove</h1>
                <p class="text-[9px] text-zinc-500 font-black uppercase tracking-[0.2em] italic">Decipher the culture.</p>
            </div>
        </div>
        <div class="flex items-center gap-6">
            <button onclick="operativePulse()" class="pulse-btn">Operative Pulse</button>
            <span class="text-[9px] text-blue-400 font-black uppercase tracking-[0.3em] hidden md:block">Witbank Sector // V290</span>
        </div>
    </header>

    <div class="liquid-mainframe">
        
        <section class="command-tile area-gateway p-8">
            <div id="auth-fields">
                <p class="text-[10px] text-gold font-black uppercase mb-6 border-b border-gold/20 pb-2">Identity Portal</p>
                <input id="login-user" type="text" placeholder="GMAIL" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white mb-3 text-xs outline-none">
                <input id="login-pass" type="password" placeholder="PASSCODE" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white mb-6 text-xs outline-none">
                <button onclick="handleMainAuth()" class="w-full bg-white text-black font-black py-4 rounded-full text-[10px] uppercase">Authorize</button>
                <p class="text-[8px] text-zinc-600 font-black uppercase mt-6 text-center italic">Decipher the culture.</p>
            </div>
            <div id="active-op-badge" class="hidden text-center h-full flex flex-col justify-center">
                <h2 id="display-op-id" class="text-3xl text-white font-black uppercase italic">OPERATIVE</h2>
                <p class="text-[9px] text-blue-400 font-black uppercase mt-2 italic">Clearance Active</p>
            </div>
        </section>

        <section class="command-tile area-messenger">
            <div class="flex-grow flex flex-col bg-[#0b141a] m-1 rounded-[30px] overflow-hidden">
                <div id="chat-stream" class="flex-grow p-6 overflow-y-auto space-y-4"></div>
                <div class="bg-[#202c33] p-4 flex gap-3">
                    <input type="text" id="chat-msg" placeholder="Encode message..." class="flex-grow bg-[#2a3942] border-0 rounded-full px-6 py-3 text-xs text-white outline-none">
                    <button onclick="sendMessage()" class="w-12 h-12 bg-blue-500 text-black rounded-full flex items-center justify-center"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </div>
        </section>

        <section class="command-tile area-gallery">
            <div class="p-6 border-b border-white/5 flex justify-between items-center">
                <p class="text-[10px] text-white font-black uppercase italic">M.O.G. Visuals</p>
                <i class="fa-solid fa-video text-blue-400"></i>
            </div>
            <div class="scroller-container">
                <div class="matrix-grid" id="gallery-matrix"></div>
            </div>
        </section>

        <section class="command-tile area-vault">
            <div class="p-6 border-b border-white/5 flex justify-between items-center">
                <p class="text-[10px] text-white font-black uppercase italic">Mandate Archive</p>
                <i class="fa-solid fa-file-audio text-gold"></i>
            </div>
            <div class="scroller-container">
                <div class="matrix-grid" id="vault-matrix"></div>
            </div>
        </section>

        <section class="command-tile area-hitlist">
            <div class="p-6 border-b border-white/5 flex justify-between items-center">
                <p class="text-[10px] text-white font-black uppercase italic">Hitlist Status</p>
                <i class="fa-brands fa-spotify text-[#1DB954]"></i>
            </div>
            <div class="scroller-container">
                <div class="matrix-grid" id="hitlist-matrix"></div>
            </div>
        </section>

    </div>

    <div id="director-console" style="display:none;" class="fixed inset-0 z-[10000] bg-black/95 flex items-center justify-center p-6">
        <div class="command-tile p-12 max-w-4xl w-full border-gold/40">
            <h2 class="text-2xl text-white font-black uppercase italic mb-8 border-b border-white/5 pb-4">Director Suite</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8 text-center">
                <button onclick="triggerManualPulse()" class="bg-blue-500 text-black font-black uppercase p-6 rounded-3xl text-xs">Authorize Grid Pulse</button>
                <div class="p-6">
                    <p class="text-[10px] text-zinc-500 uppercase">System Slogan Status</p>
                    <p class="text-xl text-gold font-black uppercase italic">Decipher the culture.</p>
                </div>
            </div>
            <button onclick="toggleUI('director-console')" class="text-xs text-zinc-600 uppercase w-full">Close Console</button>
        </div>
    </div>
    
    <script>
        const MOG_CFG = {
            U: "https://vbkpatwvgvwarybbpiky.supabase.co",
            K: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZia3BhdHd2Z3Z3YXJpYmJwaWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExMjc0MTksImV4cCI6MjA4NjcwMzQxOX0.v3iWw2z9vL-X6pGjY0W_S5m1z0S8uI1L8yN7fL0M_Y8"
        };
        const db = window.supabase.createClient(MOG_CFG.U, MOG_CFG.K);
        let currentOp = null;

        function toggleDrawer() { document.getElementById('side-drawer').classList.toggle('drawer-active'); }
        function toggleUI(id) { 
            const el = document.getElementById(id);
            el.style.display = el.style.display === 'none' ? 'flex' : 'none'; 
        }

        async function operativePulse() {
            document.body.style.opacity = '0.7';
            document.getElementById('log-drum').play();
            setTimeout(() => document.body.style.opacity = '1', 300);
        }

        function initMatrixContent() {
            const gal = document.getElementById('gallery-matrix');
            for(let i=1; i<=6; i++) {
                gal.innerHTML += `
                    <div class="item-card p-0">
                        <div class="video-card">
                            <video muted loop onclick="this.paused ? this.play() : this.pause()">
                                <source src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/clip${i}.mp4" type="video/mp4">
                            </video>
                        </div>
                    </div>`;
            }
            
            const vlt = document.getElementById('vault-matrix');
            for(let i=1; i<=6; i++) {
                vlt.innerHTML += `
                    <div class="item-card bg-white/5">
                        <i class="fa-solid fa-compact-disc text-gold mb-2 text-xl"></i>
                        <p class="text-[8px] text-white font-black uppercase">Mandate_S0${i}</p>
                        <button class="mt-2 text-[7px] bg-gold text-black font-black px-2 py-1 rounded">PLAY</button>
                    </div>`;
            }

            const hit = document.getElementById('hitlist-matrix');
            for(let i=1; i<=10; i++) {
                hit.innerHTML += `
                    <div class="item-card bg-white/5">
                        <p class="text-[7px] text-white font-black uppercase">HIT_RANK_${i}</p>
                    </div>`;
            }
        }

        /* SUPABASE REALTIME */
        const channel = db.channel('public:messages')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, (payload) => {
                document.getElementById('log-drum').currentTime = 0;
                document.getElementById('log-drum').play().catch(() => {});
                appendMsg(payload.new); 
            }).subscribe();

        function appendMsg(m) {
            const stream = document.getElementById('chat-stream');
            const div = document.createElement('div');
            div.className = `bubble ${m.user_id === currentOp?.id ? 'sent' : 'received'}`;
            div.innerHTML = `<span class="text-[8px] font-black uppercase block mb-1 text-gold">@${m.alias}</span>${m.content}`;
            stream.appendChild(div);
            stream.scrollTop = stream.scrollHeight;
        }

        async function handleMainAuth() {
            const email = document.getElementById('login-user').value.trim();
            const pass = document.getElementById('login-pass').value;
            const { data, error } = await db.auth.signInWithPassword({ 
                email: email.includes('@') ? email : `${email}@user.mog.internal`, 
                password: pass 
            });
            if(!error) { 
                currentOp = data.user; 
                document.getElementById('auth-fields').classList.add('hidden');
                document.getElementById('active-op-badge').classList.remove('hidden');
                const { data: reg } = await db.from('registrations').select('alias').eq('user_id', currentOp.id).single();
                if(reg) document.getElementById('display-op-id').innerText = reg.alias;
            } else { alert(error.message); }
        }

        window.onload = () => { initMatrixContent(); };
    </script>
</body>
</html>
