<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <meta name="description" content="Ministry of Groove: Decrypting the Culture. Synchronizing the Grid.">
    <title>M.O.G. | NATIONAL AMAPIANO GRID V54.2.0</title>
    
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        @import url('https://api.fontshare.com/v2/css?f[]=clash-display@700&f[]=satoshi@400,900&display=swap');
        :root { --mog-gold: #D4AF37; --mog-blue: #00d4ff; --mog-bg: #060a0f; --mog-panel: rgba(10, 20, 30, 0.95); --wa-bg: #0b141a; }
        
        * { transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); font-family: 'Satoshi', sans-serif; -webkit-tap-highlight-color: transparent; }
        h1, .tile-title { font-family: 'Clash Display', sans-serif; }
        .brand-title { font-size: clamp(1.5rem, 8vw, 3rem); line-height: 1.1; }

        /* MOTHERBOARD CIRCUIT PATTERN BACKGROUND */
        body { 
            background-color: var(--mog-bg); 
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(0, 212, 255, 0.1) 0%, transparent 85%),
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 10 L30 10 L30 30 M70 10 L90 10 L90 30 M10 90 L10 70 L30 70 M90 90 L90 70 L70 70 M30 30 L50 30 L50 50 L70 50 L70 70' stroke='%2300d4ff' stroke-width='0.5' fill='none' opacity='0.2'/%3E%3Ccircle cx='30' cy='30' r='1' fill='%2300d4ff' opacity='0.4'/%3E%3Ccircle cx='70' cy='70' r='1' fill='%2300d4ff' opacity='0.4'/%3E%3Ccircle cx='50' cy='50' r='1' fill='%2300d4ff' opacity='0.4'/%3E%3C/svg%3E");
            background-attachment: fixed;
            color: var(--mog-gold); margin: 0; overflow-x: hidden;
        }

        #ticker-wrap { position: fixed; top: 0; width: 100%; background: #000; border-bottom: 1px solid var(--mog-gold); z-index: 1000; height: 35px; display: flex; align-items: center; overflow: hidden; -webkit-mask-image: linear-gradient(to right, black 75%, transparent 100%); mask-image: linear-gradient(to right, black 75%, transparent 100%); }
        .ticker-move { display: inline-block; white-space: nowrap; animation: ticker 45s linear infinite; font-size: 9px; font-weight: 900; letter-spacing: 2.5px; color: var(--mog-gold); text-transform: uppercase; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        #app-content { margin-top: 80px; padding: 20px; }
        .command-tile { background: var(--mog-panel); border: 1px solid rgba(0, 212, 255, 0.3); backdrop-filter: blur(40px); border-radius: 28px; overflow: hidden; position: relative; box-shadow: 0 15px 50px rgba(0, 0, 0, 0.8); }
        .tile-header { border-bottom: 1px solid rgba(0, 212, 255, 0.2); padding: 18px 24px; background: linear-gradient(90deg, rgba(0, 212, 255, 0.1) 0%, transparent 100%); }
        .tile-title { letter-spacing: 4px; text-transform: uppercase; font-size: 10px; color: var(--mog-blue); font-weight: 700; }

        .scroller-v { overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--mog-blue) transparent; }
        .scroller-v::-webkit-scrollbar { width: 6px; }
        .scroller-v::-webkit-scrollbar-thumb { background: var(--mog-blue); border-radius: 10px; }

        .director-only { display: none; }
        .director-active .director-only { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        #side-menu { position: fixed; top: 0; left: -300px; width: 300px; height: 100%; background: #0a0e14; border-right: 1px solid var(--mog-blue); z-index: 2000; padding: 40px 20px; transition: 0.5s; }
        #side-menu.active { left: 0; }
        
        .wa-bubble { position: relative; max-width: 85%; padding: 10px 14px; border-radius: 12px; margin-bottom: 8px; font-size: 13px; color: #e9edef; line-height: 1.4; }
        .wa-in { background: #202c33; align-self: flex-start; border-bottom-left-radius: 2px; }
        .wa-out { background: #005c4b; align-self: flex-end; border-bottom-right-radius: 2px; }

        /* SILENT MODE TOGGLE UI */
        .toggle-container { display: flex; align-items: center; justify-content: space-between; padding: 15px; border-bottom: 1px solid rgba(0,212,255,0.1); }
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; border: 1px solid var(--mog-blue); }
        .slider:before { position: absolute; content: ""; height: 12px; width: 12px; left: 4px; bottom: 3px; background-color: var(--mog-blue); transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #00a884; border-color: #00a884; }
        input:checked + .slider:before { transform: translateX(20px); background-color: white; }
    </style>
</head>
<body class="scrollbar-hide" id="main-body">

    <button onclick="toggleMenu()" class="fixed top-10 left-6 z-[2500] text-blue-400 text-2xl hover:text-gold"><i class="fa-solid fa-bars-staggered"></i></button>
    
    <nav id="side-menu">
        <div class="mb-10 flex items-center gap-4"><img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" class="h-10 w-10"><span class="text-gold font-black text-xs">M.O.G. FOLDERS</span></div>
        
        <div class="toggle-container">
            <span class="text-white uppercase text-[10px] font-black">Silent Mode</span>
            <label class="switch">
                <input type="checkbox" id="silent-toggle">
                <span class="slider"></span>
            </label>
        </div>

        <a class="block p-4 text-white uppercase text-[11px] border-b border-white/5">Intel Folders</a>
        <a class="block p-4 text-white uppercase text-[11px] border-b border-white/5">RSA Archive</a>
        <a class="block p-4 text-white uppercase text-[11px] border-b border-white/5">Directives</a>
        <button onclick="toggleMenu()" class="mt-10 text-zinc-500 text-[9px] uppercase tracking-widest">Close</button>
    </nav>

    <div id="ticker-wrap"><div class="ticker-move">MASTER_SYNC_V54.2 // STEALTH_MODE_READY // MOTHERBOARD_GRID // SPOTIFY_HITLIST // DIRECTOR_ONLINE...</div></div>

    <div id="app-content" class="opacity-1 transition-opacity duration-1000">
        <header class="flex flex-col lg:flex-row justify-between items-center gap-10 relative z-50 mb-10 pl-12 lg:pl-0">
            <div class="flex items-center gap-8 w-full">
                <img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" class="h-[82px] w-[82px] border-2 border-blue-500/50 rounded-full shadow-2xl">
                <div class="w-full">
                    <h1 class="brand-title text-[#D4AF37] tracking-[.25em] uppercase font-black">Ministry of Groove</h1>
                    <p class="text-[10px] text-blue-400 tracking-[.6em] mt-3 uppercase font-black">Decrypting the Culture. Synchronizing the Grid.</p>
                </div>
            </div>
            <div class="flex flex-col items-end text-right">
                <div class="text-[12px] text-zinc-500 font-black border border-white/10 px-8 py-3 bg-white/5 tracking-[.6em] rounded-full italic opacity-50">GRID_SECURE</div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-10 relative z-50">
            
            <div class="lg:col-span-4 space-y-10">
                <section class="command-tile p-8">
                    <div id="auth-ui" class="space-y-4">
                        <div class="text-center font-black text-blue-400 text-[10px] uppercase">Sovereign Registry</div>
                        <input id="email-in" type="email" placeholder="ACCESS EMAIL" class="w-full bg-black/40 border border-blue-500/20 rounded-xl p-4 text-white text-[10px] outline-none">
                        <input id="pass-in" type="password" placeholder="DIRECTOR CODE" class="w-full bg-black/40 border border-gold/20 rounded-xl p-4 text-gold text-[10px] outline-none hidden">
                        <div class="grid grid-cols-2 gap-4"><button onclick="handleAuth()" class="border border-blue-400 p-3 rounded-xl text-[10px] font-bold">Login</button><button onclick="handleAuth()" class="border border-gold p-3 rounded-xl text-[10px] font-bold">Signup</button></div>
                    </div>
                </section>

                <section class="command-tile border-blue-500/40">
                    <div class="tile-header flex justify-between"><span class="tile-title text-blue-500">National Territorial Radar</span><i class="fa-solid fa-satellite-dish animate-pulse"></i></div>
                    <div class="h-64 relative overflow-hidden"><iframe class="w-full h-full grayscale invert opacity-50 contrast-150 border-none scale-110" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d14348.66779083556!2d29.2014842!3d-25.872715!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1e9d123456789abc%3A0x1234567890abcdef!2seMalahleni!5e0!3m2!1sen!2sza!4v1620000000000!5m2!1sen!2sza6"></iframe></div>
                </section>

                <section class="command-tile h-[300px] flex flex-col">
                    <div class="tile-header flex justify-between"><span class="tile-title text-gold">Sovereign MP3 Archive</span><i class="fa-solid fa-compact-disc"></i></div>
                    <div class="flex-grow p-4 scroller-v space-y-3" id="archive-grid">
                        <div class="p-3 bg-white/5 rounded-xl flex items-center gap-4">
                            <span class="text-[9px] font-black text-white uppercase italic truncate">MOG_Handshake_V1.mp3</span>
                            <audio src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/music.mp3" controls class="flex-grow h-6"></audio>
                        </div>
                    </div>
                </section>
            </div>

            <div class="lg:col-span-8 space-y-10">
                <section class="command-tile border-blue-500/20">
                    <div class="tile-header flex justify-between"><span class="tile-title text-blue-400 font-black tracking-widest">Visual Intel Archive</span><i class="fa-solid fa-shield-halved text-blue-400"></i></div>
                    <div id="gallery-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4 p-5 max-h-[480px] scroller-v"></div>
                </section>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <section class="command-tile h-[600px] flex flex-col">
                        <div class="tile-header flex justify-between items-center"><span class="tile-title">Frequency Grid (Spotify Top 10)</span><i class="fa-brands fa-spotify text-2xl text-[#1DB954]"></i></div>
                        <div class="flex-grow scroller-v">
                            <iframe style="border-radius:0px" src="https://open.spotify.com/embed/playlist/37i9dQZEVXbO789QXCHY7F?utm_source=generator&theme=0" width="100%" height="1000" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                        </div>
                    </section>

                    <section class="command-tile h-[600px] flex flex-col" style="background: var(--wa-bg);">
                        <div class="tile-header bg-[#202c33] flex justify-between py-3 px-4"><span class="tile-title text-white font-black">Frequency Chat</span><i class="fa-solid fa-lock text-[10px] text-zinc-500"></i></div>
                        <div id="chat-stream" class="flex-grow p-4 scroller-v flex flex-col" style="background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-blend-mode: overlay;"></div>
                        <div class="p-3 bg-[#202c33] flex items-center gap-3">
                            <input type="text" id="chat-msg-in" placeholder="Type a message" class="flex-grow bg-[#2a3942] rounded-lg p-3 text-white text-sm outline-none">
                            <button onclick="sendPacket()" class="bg-[#00a884] text-white rounded-full w-12 h-12 flex items-center justify-center"><i class="fa-solid fa-paper-plane"></i></button>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </div>
    
    <section id="director-dashboard" class="hidden fixed inset-0 z-[3000] bg-black/98 p-10 overflow-y-auto">
        <div class="flex justify-between items-center mb-8 border-b border-gold/30 pb-4"><h2 class="text-3xl text-white font-black uppercase">Director Command</h2><button onclick="toggleDirectorUI()" class="text-white text-2xl"><i class="fa-solid fa-xmark"></i></button></div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
            <div class="command-tile p-6 border-gold/40">
                <span class="text-[9px] text-gold uppercase font-black">Liquid Assets</span>
                <p class="text-2xl text-white font-black mt-2">R73,827.00</p>
            </div>
            <div class="command-tile p-6 border-gold/40">
                <span class="text-[9px] text-gold uppercase font-black">RSA Bond Yield</span>
                <p class="text-2xl text-white font-black mt-2">R13,827.19</p>
            </div>
            <div class="command-tile p-6 border-gold/40">
                <span class="text-[9px] text-gold uppercase font-black">Projected Grooves</span>
                <p class="text-2xl text-white font-black mt-2">+12% Monthly</p>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">
            <div class="command-tile p-6 space-y-4"><h3 class="tile-title text-gold">Upload Archive</h3><input type="file" id="mp3-upload" accept="audio/mp3" onchange="uploadArchive(this)"></div>
            <div class="command-tile p-6 space-y-4"><h3 class="tile-title text-gold">Directive</h3><textarea id="bulletin-msg" class="w-full h-24 bg-black p-2 text-gold text-xs outline-none"></textarea><button onclick="broadcastBulletin()" class="w-full border border-gold p-2 mt-2 text-gold uppercase text-xs">Broadcast</button></div>
        </div>
    </section>

    <button id="admin-trigger" class="hidden fixed bottom-12 right-12 z-[2500] bg-gold text-black w-16 h-16 rounded-full flex items-center justify-center animate-bounce shadow-2xl" onclick="toggleDirectorUI()"><i class="fa-solid fa-crown text-xl"></i></button>

    <script>
        const CFG = { U: "https://vbkpatwvgvwarybbpiky.supabase.co", K: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZia3BhdHd2Z3Z3YXJpYmJwaWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExMjc0MTksImV4cCI6MjA4NjcwMzQxOX0.v3iWw2z9vL-X6pGjY0W_S5m1z0S8uI1L8yN7fL0M_Y8" };
        const db = window.supabase.createClient(CFG.U, CFG.K);
        let currentUser = null;
        let lastArchiveCount = 0;

        const notifySound = new Audio("https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/notification.mp3");

        function toggleMenu() { document.getElementById('side-menu').classList.toggle('active'); }
        function showDirectorLogin() { document.getElementById('pass-in').classList.toggle('hidden'); }
        function toggleDirectorUI() { document.getElementById('director-dashboard').classList.toggle('hidden'); }
        
        async function handleAuth() {
            const email = document.getElementById('email-in').value.toLowerCase();
            const pass = document.getElementById('pass-in').value;
            if (email === 'director.mog@gmail.com' && (pass === '7486' || pass === '@MOGProtocol2026')) {
                currentUser = { id: 'DIRECTOR', email };
                document.getElementById('main-body').classList.add('director-active');
                document.getElementById('auth-ui').classList.add('hidden');
                document.getElementById('admin-trigger').classList.remove('hidden');
                fetchGallery(); fetchArchive(); fetchMessages();
            }
        }

        async function fetchArchive() {
            const { data } = await db.storage.from('archive').list('public');
            if (data) {
                const isSilent = document.getElementById('silent-toggle').checked;
                if (lastArchiveCount > 0 && data.length > lastArchiveCount && !isSilent) {
                    notifySound.play().catch(e => console.log("Muted or Handshake required"));
                }
                lastArchiveCount = data.length;
                document.getElementById('archive-grid').innerHTML = data.map(f => {
                    const { data: { publicUrl } } = db.storage.from('archive').getPublicUrl(`public/${f.name}`);
                    return `<div class="p-3 bg-white/5 rounded-xl flex items-center gap-4"><span class="text-[9px] font-black text-white uppercase italic truncate">${f.name}</span><audio src="${publicUrl}" controls class="flex-grow h-6"></audio></div>`;
                }).join('');
            }
        }

        async function uploadArchive(input) { if (input.files[0]) await db.storage.from('archive').upload(`public/${input.files[0].name}`, input.files[0]); fetchArchive(); }
        async function fetchMessages() { const { data } = await db.from('messages').select('*').order('created_at', { ascending: true }); if (data) data.forEach(displayMessage); }
        function displayMessage(m) {
            const s = document.getElementById('chat-stream');
            const d = document.createElement('div');
            const isMe = m.alias === 'DIRECTOR_MOG';
            d.className = `wa-bubble ${isMe ? 'wa-out' : 'wa-in'}`;
            d.innerHTML = `<p class="font-black text-[10px] ${isMe ? 'text-zinc-200' : 'text-blue-400'} mb-1">${m.alias || 'OPERATIVE'}</p><p>${m.content}</p>`;
            s.appendChild(d); s.scrollTop = s.scrollHeight;
        }

        async function sendPacket() {
            const i = document.getElementById('chat-msg-in'); if(!i.value || !currentUser) return;
            const alias = currentUser.email === 'director.mog@gmail.com' ? 'DIRECTOR_MOG' : currentUser.email.split('@')[0];
            await db.from('messages').insert([{ content: i.value, user_id: currentUser.id, alias: alias }]); i.value = "";
        }

        async function fetchGallery() {
            const { data } = await db.storage.from('gallery').list('public', { limit: 50, sortBy: { column: 'name', order: 'desc' } });
            if (data) document.getElementById('gallery-grid').innerHTML = data.map(f => {
                const { data: { publicUrl } } = db.storage.from('gallery').getPublicUrl(`public/${f.name}`);
                return `<div class="gallery-node h-40 overflow-hidden rounded-xl border border-white/10"><img src="${publicUrl}" class="w-full h-full object-cover opacity-80"></div>`;
            }).join('');
        }

        function initRadar() { const c = document.getElementById('radar-canvas'); const ctx = c.getContext('2d'); let w = c.width = c.parentElement.offsetWidth, h = c.height = c.parentElement.offsetHeight; let r = 0; function draw() { ctx.clearRect(0,0,w,h); r += 1.8; if(r > w/2) r = 0; ctx.beginPath(); ctx.arc(w/2, h/2, r, 0, Math.PI*2); ctx.strokeStyle = `rgba(0, 212, 255, ${1 - r/(w/2)})`; ctx.lineWidth = 2; ctx.stroke(); requestAnimationFrame(draw); } draw(); }
        window.addEventListener('load', () => { initRadar(); fetchGallery(); fetchArchive(); setInterval(fetchArchive, 10000); });
    </script>
</body>
</html>
