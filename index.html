<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>M.O.G. | NATIONAL AMAPIANO GRID V63.1.0</title>
    
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        @import url('https://api.fontshare.com/v2/css?f[]=clash-display@700&f[]=satoshi@400,900&display=swap');
        :root { --mog-gold: #D4AF37; --mog-blue: #00d4ff; --mog-bg: #060a0f; --mog-panel: rgba(10, 20, 30, 0.95); }
        
        * { transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); font-family: 'Satoshi', sans-serif; -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        h1, .tile-title { font-family: 'Clash Display', sans-serif; }
        
        .brand-title { font-size: clamp(1.3rem, 5.5vw, 3rem); line-height: 1; word-wrap: break-word; }
        .grid-subtext { font-size: clamp(0.55rem, 1.8vw, 0.8rem); letter-spacing: 0.35em; }

        body { 
            background-color: var(--mog-bg); 
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(0, 212, 255, 0.1) 0%, transparent 85%),
                url("data:image/svg+xml,%3Csvg id='circuit' width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 10 L30 10 L30 30 M70 10 L90 10 L90 30 M10 90 L10 70 L30 70 M90 90 L90 70 L70 70 M30 30 L50 30 L50 50 L70 50 L70 70' stroke='%2300d4ff' stroke-width='0.5' fill='none' opacity='0.2'/%3E%3Ccircle cx='30' cy='30' r='1' fill='%2300d4ff' opacity='0.3'/%3E%3C/svg%3E");
            background-attachment: fixed;
            color: var(--mog-gold); margin: 0; overflow-x: hidden;
            width: 100vw; min-height: 100vh;
        }

        .director-active body {
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(212, 175, 55, 0.2) 0%, transparent 85%),
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 10 L30 10 L30 30 M70 10 L90 10 L90 30 M10 90 L10 70 L30 70 M90 90 L90 70 L70 70 M30 30 L50 30 L50 50 L70 50 L70 70' stroke='%23D4AF37' stroke-width='0.5' fill='none' opacity='0.3'/%3E%3C/svg%3E");
            animation: goldPulse 4s infinite alternate ease-in-out;
        }
        @keyframes goldPulse { from { filter: brightness(1); } to { filter: brightness(1.25); } }

        .auth-input { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 16px; width: 100%; color: white; outline: none; font-size: 14px; }
        .auth-input:focus { border-color: var(--mog-blue); box-shadow: 0 0 15px rgba(0, 212, 255, 0.1); }
        .auth-btn { background: white; color: black; font-weight: 900; border-radius: 30px; padding: 14px; width: 100%; text-transform: uppercase; letter-spacing: 1px; }

        .mog-chat-row { display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end; width: 100%; }
        .mog-chat-logo { width: 22px; height: 22px; border-radius: 50%; border: 1px solid var(--mog-blue); background: #000; padding: 2px; flex-shrink: 0; }
        .mog-bubble { padding: 10px 15px; border-radius: 18px; font-size: 13px; color: #fff; background: rgba(0, 212, 255, 0.05); border: 1px solid rgba(0, 212, 255, 0.15); max-width: 85%; overflow-wrap: break-word; }

        .scroller-v { overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--mog-blue) transparent; -webkit-overflow-scrolling: touch; }
        .scroller-v::-webkit-scrollbar { width: 4px; }
        .scroller-v::-webkit-scrollbar-thumb { background: var(--mog-blue); border-radius: 10px; }
        
        #app-content { padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); margin-top: 50px; }
        .command-tile { background: var(--mog-panel); border: 1px solid rgba(0, 212, 255, 0.2); backdrop-filter: blur(25px); border-radius: 28px; overflow: hidden; }

        .director-only { display: none; }
        .director-active .director-only { display: block; animation: fadeIn 0.5s ease; }
    </style>
</head>
<body class="scrollbar-hide" id="main-body-wrap">

    <div id="ticker-wrap" class="fixed top-0 w-full bg-black z-[1000] h-[35px] border-b border-gold flex items-center overflow-hidden">
        <div class="ticker-move text-[9px] font-black uppercase text-gold">MASTER_V63.1 // AUTH_SYNC_COMPLETE // GMAIL_HANDSHAKE_LIVE // STEALTH_BYPASS // SLOGAN_RESTORED...</div>
    </div>

    <button onclick="toggleMenu()" class="fixed top-12 right-5 z-[2500] text-blue-400 text-2xl p-2 bg-black/40 rounded-full border border-white/5 backdrop-blur-md hover:text-gold shadow-xl">
        <i class="fa-solid fa-bars-staggered"></i>
    </button>
    
    <nav id="side-menu" class="fixed top-0 right-[-320px] w-[300px] h-full bg-[#080c10] border-l border-white/5 p-8 z-[3000] transition-all duration-500 shadow-2xl">
        <div class="mb-10 flex items-center justify-between">
            <img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" class="h-10 w-10 border border-blue-500/30 rounded-full">
            <button onclick="toggleMenu()" class="text-zinc-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="space-y-6">
            <div class="flex justify-between items-center p-4 bg-white/5 rounded-xl border border-white/10">
                <span class="text-[10px] uppercase font-black text-zinc-400">Silent Mode</span>
                <input type="checkbox" id="silent-toggle">
            </div>
            <a class="block p-4 text-white uppercase text-[11px] font-black border-b border-white/5">Grid Architecture</a>
        </div>
    </nav>

    <div id="app-content" class="container mx-auto px-4">
        <header class="flex flex-col md:flex-row justify-between items-center gap-6 mb-12 pt-4">
            <div class="flex items-center gap-6 w-full">
                <img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" id="mog-master-logo" onclick="handleLogoSequence()" class="h-16 w-16 md:h-24 md:w-24 border-2 border-blue-500/50 rounded-full cursor-pointer shadow-2xl active:scale-90">
                <div class="min-w-0 flex-grow">
                    <h1 class="brand-title text-[#D4AF37] uppercase font-black">Ministry of Groove</h1>
                    <div class="flex flex-wrap items-center gap-3 mt-1">
                        <p class="grid-subtext text-blue-400 uppercase font-black">Decrypting the Culture. Synchronizing the Grid.</p>
                        <div class="bg-black/40 px-3 py-0.5 rounded-full border border-white/5 text-[8px] text-zinc-500 font-black italic">SIGNAL: <span id="lat-val">12ms</span></div>
                    </div>
                </div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-8 pb-12">
            
            <div class="lg:col-span-4 space-y-8">
                <section class="command-tile p-8 bg-black/60 shadow-2xl">
                    <div id="auth-ui" class="space-y-6">
                        <div class="text-center mb-6"><h2 class="text-white font-black uppercase tracking-widest text-base" id="auth-title">Grid Handshake</h2></div>
                        
                        <div id="signup-fields" class="hidden space-y-4">
                            <input id="new-user" type="text" placeholder="GMAIL OR USERNAME" class="auth-input">
                            <input id="new-pass" type="password" placeholder="NEW PASSWORD" class="auth-input">
                            <button onclick="registerOperative()" class="auth-btn">Register operative</button>
                            <p class="text-[10px] text-center text-zinc-500 uppercase">Existing? <span class="text-blue-400 cursor-pointer font-black" onclick="toggleAuth()">Sign In</span></p>
                        </div>

                        <div id="signin-fields" class="space-y-4">
                            <input id="login-user" type="text" placeholder="GMAIL OR USERNAME" class="auth-input">
                            <input id="login-pass" type="password" placeholder="PASSCODE" class="auth-input">
                            <button onclick="loginOperative()" class="auth-btn">Authorize</button>
                            <p class="text-[10px] text-center text-zinc-500 uppercase">New? <span class="text-blue-400 cursor-pointer font-black" onclick="toggleAuth()">Sign Up</span></p>
                        </div>
                    </div>

                    <div id="director-login-portal" class="hidden space-y-4 pt-8 border-t border-gold/20 mt-6">
                        <input id="dir-email" type="email" placeholder="DIRECTOR_ID" class="auth-input border-gold/40 text-gold">
                        <input id="dir-pass" type="password" placeholder="BYPASS_KEY" class="auth-input border-gold/40 text-gold">
                        <button onclick="executeDirectorBypass()" class="w-full bg-gold text-black font-black p-4 rounded-full text-[10px] uppercase">Access Totality</button>
                    </div>
                </section>

                <section class="command-tile h-64 border-blue-500/20">
                    <iframe class="w-full h-full grayscale invert opacity-40 border-none scale-125" src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d7000000!2d24!3d-29!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sza!4v17100000000000"></iframe>
                </section>

                <section class="command-tile p-8 border-gold/30">
                    <span class="text-[10px] text-gold font-black uppercase tracking-widest block mb-6">Growth Protocol</span>
                    <div class="space-y-4">
                        <div class="p-4 bg-emerald-500/5 border border-emerald-500/20 rounded-xl">
                            <div class="flex justify-between text-[10px] font-black text-white uppercase"><span>Phase 1: Recruitment</span><span>142 / 500</span></div>
                            <div class="w-full bg-white/5 h-1.5 rounded-full mt-2"><div class="bg-emerald-500 h-full w-[28%] rounded-full shadow-[0_0_8px_#10b981]"></div></div>
                        </div>
                        <div class="director-only pt-6 border-t border-white/10">
                            <div class="flex justify-between text-[11px] font-black"><span class="text-gold uppercase">Wealth Index:</span><span class="text-white">R73,827.00</span></div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="lg:col-span-8 space-y-8">
                <section class="command-tile h-[600px] flex flex-col bg-black/40">
                    <div class="tile-header py-4 px-8 border-b border-white/5 flex items-center justify-between">
                        <span class="text-white font-black text-xs uppercase tracking-widest">Neural Frequency Comms</span>
                        <i class="fa-solid fa-shield-halved text-emerald-500 text-xs animate-pulse"></i>
                    </div>
                    <div id="chat-stream" class="flex-grow p-6 scroller-v flex flex-col"></div>
                    <div class="p-6 bg-black/80 flex gap-4 items-center border-t border-white/5">
                        <input type="text" id="chat-msg-in" placeholder="Message..." class="flex-grow bg-[#111] border border-white/10 rounded-full px-6 py-4 text-white text-sm outline-none">
                        <button onclick="sendPacket()" class="bg-blue-600 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-xl active:scale-90"><i class="fa-solid fa-paper-plane"></i></button>
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <script>
        const CFG = { U: "https://vbkpatwvgvwarybbpiky.supabase.co", K: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZia3BhdHd2Z3Z3YXJpYmJwaWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExMjc0MTksImV4cCI6MjA4NjcwMzQxOX0.v3iWw2z9vL-X6pGjY0W_S5m1z0S8uI1L8yN7fL0M_Y8" };
        const db = window.supabase.createClient(CFG.U, CFG.K);
        let logoClicks = 0;

        function toggleMenu() { const s = document.getElementById('side-menu'); s.style.right = s.style.right === '0px' ? '-320px' : '0px'; }
        function toggleAuth() { document.getElementById('signin-fields').classList.toggle('hidden'); document.getElementById('signup-fields').classList.toggle('hidden'); }
        
        // SIGNUP LOGIC (GMAIL OR USERNAME)
        async function registerOperative() {
            const user = document.getElementById('new-user').value;
            const pass = document.getElementById('new-pass').value;
            if(!user || !pass) return alert("Credentials Missing");
            
            // Format for Supabase: ensures Gmail or mock email for custom usernames
            const emailFormat = user.includes('@') ? user : `${user}@mog.internal`;
            
            const { data, error } = await db.auth.signUp({
                email: emailFormat,
                password: pass,
                options: { data: { display_name: user } }
            });

            if(error) {
                alert("Protocol Failed: " + error.message);
            } else {
                alert("Registration Successful. Operative added to Grid.");
                toggleAuth();
            }
        }

        // LOGIN LOGIC
        async function loginOperative() {
            const user = document.getElementById('login-user').value;
            const pass = document.getElementById('login-pass').value;
            const emailFormat = user.includes('@') ? user : `${user}@mog.internal`;
            
            const { data, error } = await db.auth.signInWithPassword({
                email: emailFormat,
                password: pass
            });

            if(error) alert("Authorization Denied.");
            else alert("Signal Synchronized. Welcome Operative.");
        }

        function handleLogoSequence() {
            logoClicks++;
            if (logoClicks === 5) { document.getElementById('director-login-portal').classList.remove('hidden'); logoClicks = 0; }
            setTimeout(() => { logoClicks = 0; }, 5000);
        }

        async function executeDirectorBypass() {
            const e = document.getElementById('dir-email').value, p = document.getElementById('dir-pass').value;
            if (e === 'director.mog@gmail.com' && (p === '7486' || p === '@MOGProtocol2026')) {
                document.documentElement.classList.add('director-active');
                alert("Sovereign Director Handshake Verified.");
            }
        }

        function displayMessage(m) {
            const s = document.getElementById('chat-stream'), d = document.createElement('div');
            d.className = `mog-chat-row`;
            d.innerHTML = `<img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" class="mog-chat-logo"><div class="mog-bubble"><p class="text-[8px] font-black uppercase text-blue-400 mb-0.5">${m.alias || 'Operative'}</p><p>${m.content}</p></div>`;
            s.appendChild(d); s.scrollTop = s.scrollHeight;
        }

        async function fetchMessages() { const { data } = await db.from('messages').select('*').order('created_at', { ascending: true }); if (data) { document.getElementById('chat-stream').innerHTML = ""; data.forEach(displayMessage); } }
        window.addEventListener('load', () => { fetchMessages(); setInterval(() => { document.getElementById('lat-val').innerText = `${Math.floor(Math.random()*10)+8}ms`; }, 4000); });
    </script>
</body>
</html>
