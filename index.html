<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png">

    <title>M.O.G. | MINISTRY OF GROOVE</title>
    <meta name="description" content="Sovereign sound transmitted from the eMalahleni Sector. Join the Grid frequency.">
    <meta property="og:title" content="Ministry of Groove | Official Grid">
    <meta property="og:description" content="Secure communication and sovereign sound transmission for the eMalahleni Sector.">
    <meta property="og:image" content="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png">
    <meta property="og:url" content="https://ministry-of-groove.vercel.app/">
    <meta property="twitter:card" content="summary_large_image">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/easyqrcodejs@4.4.13/dist/easy.qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Big+Shoulders+Display:wght@900&family=JetBrains+Mono:wght@700&family=Inter:wght@400;900&display=swap" rel="stylesheet">

    <style>
        :root { 
            --mog-gold: #D4AF37; --mog-blue: #00d4ff; --mog-black: #050505; 
            --mog-glass: rgba(5, 12, 20, 0.95); --mog-border: rgba(0, 212, 255, 0.2);
            --mog-neon-blue: rgba(0, 212, 255, 0.6);
        }

        html, body { min-height: 100vh; width: 100vw; margin: 0; padding: 0; overflow-x: hidden; background-color: var(--mog-black); color: #fff; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }
        * { transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); }

        /* PERFORMANCE FIX: GPU ACCELERATED BACKGROUND */
        #bg-canvas { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle at 50% 50%, rgba(0, 212, 255, 0.08) 0%, transparent 70%); transform: translateZ(0); }

        /* UNIFIED MASTER GRID */
        .mainframe-wrapper { 
            display: grid; padding: 20px; gap: 20px; 
            grid-template-columns: 1.2fr 1.6fr 1fr; 
            grid-template-areas: "gateway messenger chart" "location messenger vault" "history messenger requests" "director director director"; 
            max-width: 1900px; margin: 0 auto; 
        }
        @media (max-width: 1200px) { 
            .mainframe-wrapper { 
                grid-template-columns: 1fr; 
                grid-template-areas: "gateway" "messenger" "chart" "location" "vault" "history" "requests" "director"; 
                padding: 15px; 
            } 
        }

        .command-tile { background: var(--mog-glass); border: 1px solid var(--mog-border); border-radius: 35px; overflow: hidden; backdrop-filter: blur(40px); position: relative; }
        .logo-wrapper { position: relative; padding: 6px; border-radius: 50%; background: conic-gradient(from 0deg, var(--mog-gold), var(--mog-blue), var(--mog-gold)); box-shadow: 0 0 25px var(--mog-neon-blue); animation: rotate-orbit 12s linear infinite; }
        @keyframes rotate-orbit { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        #countdown-hub { background: rgba(0, 212, 255, 0.05); border: 1px solid rgba(0, 212, 255, 0.2); padding: 5px 20px; border-radius: 50px; display: none; align-items: center; gap: 12px; }
        #live-siren, #ascension-overlay, #share-overlay { position: fixed; inset: 0; z-index: 10001; background: rgba(0,0,0,0.98); display: none; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(50px); padding: 20px; }
        
        .director-active #director-tile { display: block; }
        #director-tile { grid-area: director; display: none; border: 2px solid #ef4444; background: rgba(239, 68, 68, 0.05); margin-top: 20px; }

        .master-btn { background: var(--mog-gold); color: #000; font-weight: 900; border-radius: 18px; padding: 18px; width: 100%; text-transform: uppercase; cursor: pointer; letter-spacing: 1px; font-size: 11px; border: none; }
        .mog-input { background: rgba(255,255,255,0.03); border: none; border-bottom: 1px solid var(--mog-border); padding: 12px 0; color: #fff; width: 100%; outline: none; text-align: center; font-family: 'JetBrains Mono', monospace; font-size: 12px; }
        
        /* VIRAL MATRIX UI */
        .share-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; width: 100%; max-width: 400px; }
        .share-node { aspect-ratio: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 22px; }
        .share-node:hover { background: var(--mog-gold); color: #000; }

        .vault-item { background: #000; border: 1px solid var(--mog-border); border-radius: 25px; overflow: hidden; margin-bottom: 15px; }
        .vlog-badge { border: 2px solid var(--mog-gold); box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); }

        /* SCROLL REFINEMENT */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--mog-gold); border-radius: 10px; }
    </style>
</head>
<body class="pb-32">
    <div id="bg-canvas"></div>

    <div id="live-siren"><div class="text-center"><h1 class="text-blue-400 font-black italic text-5xl uppercase mb-8">Transmission Live</h1><button onclick="document.getElementById('live-siren').style.display='none'" class="master-btn px-20">Sync Frequency</button></div></div>
    
    <div id="ascension-overlay"><div class="text-center"><h1 class="text-gold font-black italic text-6xl uppercase mb-4 animate-bounce">Ascension</h1><p id="ascension-msg" class="text-white uppercase tracking-widest text-sm mb-12"></p><button onclick="document.getElementById('ascension-overlay').style.display='none'" class="master-btn px-20">Acknowledge</button></div></div>

    <div id="share-overlay">
        <div class="command-tile p-10 text-center max-w-sm w-full">
            <span class="text-gold font-black uppercase text-[10px] mb-8 block tracking-[0.4em]">Viral Matrix</span>
            <div class="share-grid">
                <div onclick="viralTransmit('whatsapp')" class="share-node"><i class="fa-brands fa-whatsapp"></i></div>
                <div onclick="viralTransmit('fb-msg')" class="share-node"><i class="fa-brands fa-facebook-messenger"></i></div>
                <div onclick="viralTransmit('twitter')" class="share-node"><i class="fa-brands fa-x-twitter"></i></div>
                <div onclick="viralTransmit('tiktok')" class="share-node"><i class="fa-brands fa-tiktok"></i></div>
                <div onclick="viralTransmit('youtube')" class="share-node"><i class="fa-brands fa-youtube"></i></div>
                <div onclick="viralTransmit('instagram')" class="share-node"><i class="fa-brands fa-instagram"></i></div>
            </div>
            <button onclick="document.getElementById('share-overlay').style.display='none'" class="mt-8 text-[10px] font-black uppercase text-zinc-500">Close</button>
        </div>
    </div>

    <header class="px-6 md:px-12 py-6 bg-black/60 border-b border-white/10 backdrop-blur-2xl sticky top-0 z-[1000] flex justify-between items-center">
        <div class="flex items-center gap-4">
            <div class="logo-wrapper" onclick="handleDirectorSequence()"><img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" class="h-12 w-12 md:h-16 md:w-16 rounded-full cursor-pointer"></div>
            <h1 class="text-2xl md:text-3xl font-black italic uppercase text-white tracking-tighter" style="font-family: 'Big Shoulders Display';">M.O.G.</h1>
        </div>
        <div id="countdown-hub" class="hidden md:flex"><span id="timer-display" class="font-mono text-blue-400 text-sm font-bold tracking-widest">00:00:00</span></div>
        <div class="flex items-center gap-3">
            <button onclick="document.getElementById('share-overlay').style.display='flex'" class="w-10 h-10 rounded-full border border-white/10 flex items-center justify-center"><i class="fa-solid fa-share-nodes text-xs"></i></button>
            <div class="bg-white/5 px-4 py-2 rounded-full border border-white/10 flex items-center gap-3">
                <span id="op-counter" class="text-gold font-black text-xl">0</span>
                <button onclick="initiateLogout()" class="text-red-500 text-xs"><i class="fa-solid fa-power-off"></i></button>
            </div>
        </div>
    </header>

    <main class="mainframe-wrapper">
        <section class="command-tile p-8 flex flex-col items-center justify-center" style="grid-area: gateway;">
            <div id="qrcode-container" class="bg-white p-3 rounded-2xl inline-block border-2"><div id="qrcode"></div></div>
            <h2 id="op-display-id" class="text-lg font-black italic uppercase text-white mt-4">OPERATIVE</h2>
            <div id="tier-tag" class="text-[7px] font-black uppercase mt-1 py-1 px-3 rounded-full border border-gold/20 text-gold">Novice</div>
        </section>

        <section class="command-tile min-h-[500px] flex flex-col" style="grid-area: messenger;">
            <div id="chat-stream" class="flex-grow p-6 overflow-y-auto space-y-4"></div>
            <div class="p-4 bg-black/50 flex gap-3 border-t border-white/5">
                <input type="text" id="chat-input" placeholder="Transmit packet..." class="flex-grow bg-white/5 rounded-full px-5 py-3 outline-none text-xs">
                <button onclick="sendPacket()" class="bg-blue-600 w-11 h-11 rounded-full flex items-center justify-center shadow-lg"><i class="fa-solid fa-paper-plane text-xs"></i></button>
            </div>
        </section>

        <section class="command-tile p-8 overflow-y-auto" style="grid-area: chart;"><span class="text-[9px] font-black text-gold uppercase italic mb-4 block underline">Top 10 Index</span><div id="chart-index" class="space-y-3"></div></section>
        <section class="command-tile p-8 h-48 overflow-y-auto" style="grid-area: location;"><span class="text-[9px] font-black text-blue-400 uppercase italic mb-4 block underline">Sector Coords</span><div id="location-node-container" class="space-y-4"></div></section>
        <section class="command-tile p-8 overflow-y-auto h-80" style="grid-area: vault;"><span class="text-[9px] font-black text-blue-400 uppercase italic mb-4 block underline">Intel Vault</span><div id="vault-content" class="space-y-4"></div></section>
        <section class="command-tile p-8 h-80 overflow-y-auto" style="grid-area: history;"><span class="text-[9px] font-black text-gold uppercase italic mb-4 block underline">Set Archive</span><div id="setlist-container" class="space-y-3"></div></section>
        <section class="command-tile p-8" style="grid-area: requests;"><span class="text-[9px] font-black text-blue-400 uppercase italic mb-3 block underline">Booth Request</span><input id="track-request-input" class="mog-input mb-3" placeholder="Artist - Track"><button onclick="sendRequest()" class="master-btn">Send</button></section>
                                                                           
        <section id="director-tile" class="command-tile p-10 col-span-full border-red-500/30">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-white/5 p-6 rounded-2xl"><h2 class="text-red-500 font-black italic mb-4">Master Console</h2><button onclick="triggerLiveSiren()" class="bg-blue-600 w-full py-3 rounded-xl text-[10px] font-black mb-3">Fire Siren</button><input id="target-datetime" type="datetime-local" class="mog-input mb-3"><button onclick="setTemporalTarget()" class="bg-gold text-black w-full py-3 rounded-xl text-[10px] font-black">Set Sync</button></div>
                <div class="bg-white/5 p-6 rounded-2xl"><h2 class="text-gold font-black italic mb-4">Deploy Intel</h2><input id="vault-url" class="mog-input mb-2" placeholder="URL"><input id="vault-title-in" class="mog-input mb-2" placeholder="Title"><select id="vault-type" class="w-full bg-black border border-white/10 p-2 text-xs rounded-lg mb-4"><option value="SESSION">SESSION</option><option value="VLOG">DIRECTOR VLOG</option></select><button onclick="deployVaultIntel()" class="bg-gold text-black w-full py-3 rounded-xl text-[10px] font-black">Deploy</button></div>
                <div id="request-inbox" class="bg-white/5 p-6 rounded-2xl h-56 overflow-y-auto"><h2 class="text-white font-black italic mb-4">Booth Feed</h2></div>
            </div>
        </section>
    </main>

    <footer class="fixed bottom-0 w-full bg-black/95 border-t border-gold/10 py-5 text-center z-[2000]"><p class="text-gold italic font-black text-[9px] uppercase tracking-widest">M.O.G. Â© 2026 // MPUMALANGA SECTOR HQ</p></footer>

    <script>
        const CFG = { U: "https://hzelmkthdqtbcxffsstl.supabase.co", K: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh6ZWxta3RoZHF0YmN4ZmZzc3RsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MDExOTksImV4cCI6MjA4NzM3NzE5OX0.Hx-dlAnPYqn-1GAmkS0ZNJIuvhutYdJ2_fLxAn3MTfY" };
        const db = window.supabase.createClient(CFG.U, CFG.K);
        let timerInterval, logoClicks = 0;

        function viralTransmit(p) {
            const url = encodeURIComponent(window.location.href);
            const msg = encodeURIComponent("Ministry of Groove Sovereign Frequency.");
            const h = { 'whatsapp': `https://api.whatsapp.com/send?text=${msg}%20${url}`, 'twitter': `https://twitter.com/intent/tweet?text=${msg}&url=${url}`, 'fb-msg': `fb-messenger://share?link=${url}` };
            window.open(h[p] || url, '_blank');
        }

        async function checkSecurity() {
            const { data: { user } } = await db.auth.getUser();
            if (user && sessionStorage.getItem('mog_handshake_verified') === 'true') { setupGrid(user); }
            else { initiateLogout(); }
        }

        async function setupGrid(user) {
            const alias = user.email.split('@')[0];
            document.getElementById('op-display-id').innerText = alias;
            if(user.email === 'director.mog@gmail.com') document.documentElement.classList.add('director-active');
            const { count } = await db.from('messages').select('*', { count: 'exact', head: true }).eq('alias', alias);
            processTier(count, user.email, user.id);
            fetchComms(); fetchHistory(); fetchVault(); fetchChartIndex(); fetchCoordinates();
            if(user.email === 'director.mog@gmail.com') fetchRequests();
            db.channel('sovereign-totality').on('broadcast', { event: 'live-now' }, () => document.getElementById('live-siren').style.display = 'flex')
                         .on('broadcast', { event: 'set-timer' }, p => startCountdown(p.payload.target)).subscribe();
        }

        function processTier(count, email, userId) {
            let color = "#00d4ff", label = "Novice", tClass = "tier-novice";
            if (email === 'director.mog@gmail.com' || count >= 50) { color = "#D4AF37"; label = "Elite"; tClass = "tier-elite"; }
            else if (count >= 10) { color = "#C0C0C0"; label = "Sentinel"; tClass = "tier-sentinel"; }
            const lastCount = parseInt(localStorage.getItem('mog_last_count') || 0);
            if ((count >= 10 && lastCount < 10) || (count >= 50 && lastCount < 50)) {
                document.getElementById('ascension-msg').innerText = `Role Status: ${label}`;
                document.getElementById('ascension-overlay').style.display = 'flex';
            }
            localStorage.setItem('mog_last_count', count);
            document.getElementById('qrcode-container').className = `bg-white p-3 rounded-2xl inline-block border-2 ${tClass}`;
            document.getElementById('tier-tag').innerText = label + " Status";
            document.getElementById('tier-tag').style.color = color;
            new QRCode(document.getElementById("qrcode"), { text: "MOG-OP-" + userId, width: 140, height: 140, colorDark: color, logo: "https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png", logoWidth: 40, logoHeight: 40, quietZone: 10 });
        }

        function startCountdown(target) {
            document.getElementById('countdown-hub').style.display = 'flex';
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                const dist = target - Date.now();
                if (dist < 0) { clearInterval(timerInterval); document.getElementById('live-siren').style.display = 'flex'; return; }
                const h = Math.floor(dist / 3600000), m = Math.floor((dist % 3600000) / 60000), s = Math.floor((dist % 60000) / 1000);
                document.getElementById('timer-display').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }, 1000);
        }

        function triggerLiveSiren() { db.channel('sovereign-totality').send({ type: 'broadcast', event: 'live-now' }); }
        function setTemporalTarget() { const target = document.getElementById('target-datetime').value; if(target) db.channel('sovereign-totality').send({ type: 'broadcast', event: 'set-timer', payload: { target: new Date(target).getTime() } }); }
        async function deployVaultIntel() { const u = document.getElementById('vault-url').value, t = document.getElementById('vault-type').value, l = document.getElementById('vault-title-in').value; if(u) await db.from('messages').insert([{ content: `${u}|${l}|${t}`, alias: 'VAULT_ITEM' }]); location.reload(); }
        async function fetchVault() { const { data } = await db.from('messages').select('*').eq('alias', 'VAULT_ITEM').order('created_at', { ascending: false }); const v = document.getElementById('vault-content'); if(data) { v.innerHTML = ""; data.forEach(i => { const [url, title, type] = i.content.split('|'); const e = document.createElement('div'); e.className = `vault-item ${type === 'VLOG' ? 'vlog-badge' : ''}`; e.innerHTML = `<img src="${url}" class="w-full h-24 object-cover opacity-50"><p class="p-3 text-[8px] uppercase font-black">${title}</p>`; v.appendChild(e); }); } }
        async function fetchChartIndex() { const { data } = await db.from('messages').select('*').eq('alias', 'YT_CHART').order('created_at', { ascending: false }).limit(10); const c = document.getElementById('chart-index'); if(data) { c.innerHTML = ""; data.forEach((i, x) => { const [n, v] = i.content.split('|'); const d = document.createElement('div'); d.className = "flex items-center gap-3 bg-white/5 p-3 rounded-xl cursor-pointer text-[9px] uppercase"; d.onclick = () => window.open(`https://www.youtube.com/watch?v=${v}`, '_blank'); d.innerHTML = `<span class="text-gold font-bold">#${x+1}</span>${n}`; c.appendChild(d); }); } }
        async function fetchCoordinates() { const { data } = await db.from('messages').select('*').eq('alias', 'SECTOR_LOC').limit(1); if(data && data[0]) { const [n, u] = data[0].content.split('|'); document.getElementById('location-node-container').innerHTML = `<div class="bg-blue-500/10 p-4 rounded-xl border border-blue-500/20 cursor-pointer text-[9px] uppercase font-black" onclick="window.open('${u}','_blank')">${n}</div>`; } }
        async function fetchSetArchive() { const { data } = await db.from('messages').select('*').eq('alias', 'SET_REFERENCE').order('created_at', { ascending: false }).limit(5); const s = document.getElementById('setlist-container'); if(data) { s.innerHTML = ""; data.forEach(i => { const [t, l] = i.content.split('|'); const b = document.createElement('div'); b.className = "bg-white/5 p-3 rounded-xl"; b.innerHTML = `<p class="text-white text-[9px] font-black underline mb-1">${t}</p><p class="text-zinc-500 text-[7px] uppercase truncate">${l}</p>`; s.appendChild(b); }); } }
        async function sendPacket() { const i = document.getElementById('chat-input'); const { data: { user } } = await db.auth.getUser(); if (i.value && user) await db.from('messages').insert([{ content: i.value, alias: user.email.split('@')[0] }]); i.value = ""; }
        function appendMessage(msg) { if(['REQ_','VAULT_ITEM','YT_CHART','SET_REFERENCE','SECTOR_LOC'].some(k => msg.alias.includes(k))) return; const s = document.getElementById('chat-stream'); const d = document.createElement('div'); d.className = "bg-white/5 p-3 rounded-xl border border-white/5 text-[11px]"; d.innerHTML = `<span class="text-blue-400 font-black text-[8px] block mb-1 uppercase">${msg.alias}</span>${msg.content}`; s.appendChild(d); s.scrollTop = s.scrollHeight; }
        async function fetchComms() { const { data } = await db.from('messages').select('*').order('created_at', { ascending: false }).limit(50); if (data) data.reverse().forEach(msg => appendMessage(msg)); }
        db.channel('public:messages').on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, p => appendMessage(p.new)).subscribe();
        async function initiateLogout() { await db.auth.signOut(); sessionStorage.clear(); localStorage.clear(); location.reload(); }
        async function sendRequest() { const t = document.getElementById('track-request-input').value, { data: { user } } = await db.auth.getUser(); if(t) await db.from('messages').insert([{ content: t, alias: `REQ_${user.email.split('@')[0]}` }]); document.getElementById('track-request-input').value = ""; alert("Frequency Sent."); }
        async function fetchRequests() { const { data } = await db.from('messages').select('*').like('alias', 'REQ_%').limit(10); const b = document.getElementById('request-inbox'); if(data) data.forEach(r => { const e = document.createElement('div'); e.className = "text-[8px] text-zinc-400 mb-2 p-2 bg-white/5 rounded uppercase"; e.innerHTML = `<span class="text-white">${r.alias.replace('REQ_','')}</span>: ${r.content}`; b.appendChild(e); }); }
        function handleDirectorSequence() { logoClicks++; if(logoClicks === 5) { document.documentElement.classList.add('director-active'); logoClicks = 0; } setTimeout(() => logoClicks = 0, 5000); }
        window.onload = checkSecurity;
    </script>
</body>
</html>
