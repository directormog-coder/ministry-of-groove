<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M.O.G. | THE MINISTRY OF GROOVE HQ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        :root { 
            --mog-gold: #D4AF37; 
            --mog-blue: #00d4ff; 
            --mog-black: #050505; 
            --mog-red: #ff3333; 
        }

        body { 
            font-family: 'JetBrains+Mono', monospace; 
            background-color: var(--mog-black); 
            color: var(--mog-gold); 
            overflow-x: hidden;
        }

        /* Scanline Effect */
        body::before {
            content: " ";
            position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 100;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .ministry-title { 
            color: var(--mog-gold); 
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.5); 
            letter-spacing: 0.5em; 
            text-transform: uppercase; 
            font-weight: 700;
        }
        
        .glass-panel { 
            background: rgba(10, 10, 10, 0.9); 
            backdrop-filter: blur(15px); 
            border: 1px solid rgba(212, 175, 55, 0.15); 
            transition: 0.4s ease; 
        }
        .glass-panel:hover { border-color: var(--mog-blue); box-shadow: 0 0 20px rgba(0, 212, 255, 0.1); }

        .btn-uplink { 
            background: var(--mog-gold); 
            color: #000; 
            font-weight: 700; 
            padding: 15px; 
            text-transform: uppercase; 
            width: 100%; 
            transition: 0.3s; 
            letter-spacing: 2px;
        }
        .btn-uplink:hover { background: #fff; box-shadow: 0 0 15px #fff; transform: translateY(-2px); }
        
        input { 
            background: rgba(20, 20, 20, 0.8) !important; 
            border: 1px solid rgba(0, 212, 255, 0.3) !important; 
            color: var(--mog-blue) !important; 
            padding: 15px; 
            width: 100%; 
            outline: none; 
            margin-bottom: 12px;
            font-size: 0.9rem;
        }

        .mission-card { 
            border-left: 3px solid var(--mog-gold); 
            background: rgba(255,255,255,0.02); 
            padding: 15px; 
            margin-bottom: 12px; 
        }

        .director-mode { border-color: var(--mog-red) !important; }
        
        .status-online { color: #00ff00; text-shadow: 0 0 5px #00ff00; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body class="p-4 md:p-10">

    <header class="glass-panel p-6 mb-8 flex flex-col lg:flex-row justify-between items-center gap-6">
        <div class="flex items-center gap-6">
            <div class="h-16 w-16 bg-gold rounded-full flex items-center justify-center border-2 border-gold shadow-lg">
                <span class="text-black font-bold text-xl">MOG</span>
            </div>
            <div>
                <h1 class="ministry-title text-xl md:text-2xl">The Ministry of Groove</h1>
                <p class="text-[10px] text-blue-400 tracking-[0.3em]">SECURE ACCESS POINT // EMALAHALENI NODE</p>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <span class="text-[10px] status-online">‚óè SYSTEM_LIVE</span>
            <audio id="mandate-audio" controls class="h-8 opacity-60 hover:opacity-100 transition"></audio>
        </div>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <section id="auth-panel" class="lg:col-span-4 glass-panel p-6">
            <h2 class="text-xs font-bold uppercase tracking-widest mb-6 border-b border-white/10 pb-2">Biometric Identity</h2>
            
            <div id="auth-form">
                <input id="alias-in" type="text" placeholder="OPERATIVE_ALIAS" class="uppercase">
                <input id="pass-in" type="password" placeholder="ACCESS_CODE">
                <button onclick="executeAuth()" class="btn-uplink">Establish Uplink</button>
            </div>

            <div id="op-profile" class="hidden">
                <p id="active-alias" class="text-2xl font-bold text-white uppercase"></p>
                <p class="text-[10px] text-blue-400 mb-6">CLEARANCE: LEVEL_4_OPERATIVE</p>
                <button onclick="logout()" class="text-[10px] underline opacity-40 hover:opacity-100 uppercase">Terminate Session</button>
            </div>
        </section>

        <section class="lg:col-span-8 glass-panel p-6">
            <h2 class="text-xs font-bold uppercase tracking-widest mb-6 border-b border-white/10 pb-2 text-blue-400">Global Mandates & Missions</h2>
            <div id="mission-feed" class="h-[400px] overflow-y-auto pr-4 space-y-4">
                <p class="text-xs opacity-50 italic">Scanning for encrypted data...</p>
            </div>
        </section>

        <section class="lg:col-span-12 glass-panel p-6 mb-8">
    <h2 class="text-xs font-bold uppercase tracking-widest mb-6 border-b border-white/10 pb-2 text-blue-400">Ministry Visual Archives</h2>
    <div id="legacy-gallery" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 min-h-[100px]">
        <p class="text-[10px] opacity-30 col-span-full italic">Retrieving visual intelligence...</p>
    </div>
</section>
<section id="director-node" class="hidden lg:col-span-12 glass-panel p-8 border-2 border-red-600/30 bg-red-900/5">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-red-500 font-bold uppercase text-xl tracking-widest">Directorate Control Node</h3>
                <span class="bg-red-600 text-white text-[10px] px-2 py-1">PRIORITY ALPHA</span>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <p class="text-[10px] uppercase font-bold mb-4 text-red-400">Operative Registry</p>
                    <div id="op-registry" class="h-48 overflow-y-auto bg-black/40 p-4 border border-red-900/20 font-mono text-[11px]"></div>
                </div>
                <div>
                    <p class="text-[10px] uppercase font-bold mb-4 text-red-400">Broadcast Global Mandate</p>
                    <textarea id="dr-mandate" class="w-full h-32 bg-black/60 border border-red-900/40 p-4 text-white text-sm outline-none focus:border-red-500" placeholder="Enter directive content..."></textarea>
                    <button onclick="broadcastMandate()" class="w-full bg-red-600 text-white font-bold p-4 mt-3 uppercase text-xs tracking-widest hover:bg-red-500 transition">Execute Broadcast</button>
                    <button onclick="broadcastMandate()" class="w-full bg-red-600 text-white font-bold p-4 mt-3 uppercase text-xs tracking-widest hover:bg-red-500 transition">Execute Broadcast</button>

<div class="mt-6 border-t border-red-900/20 pt-4">
    <p class="text-[10px] uppercase font-bold mb-4 text-red-400">Upload Media to Intel-Vault</p>
    <input type="file" id="media-upload" class="hidden" onchange="uploadToVault()">
    <button onclick="document.getElementById('media-upload').click()" class="w-full border border-red-600 text-red-600 p-3 uppercase text-[10px] hover:bg-red-600 hover:text-white transition">
        Select Media File
    </button>
</div>
                    
                </div>
            </div>
        </section>

    </main>

    <script>
        // UPDATED INFRASTRUCTURE KEYS
        const CONFIG = {
    U: "https://vbkpatwvgvwarybbpiky.supabase.co", 
    K: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZia3BhdHd2Z3Z3YXJpYmJwaWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNDEwOTcsImV4cCI6MjA4NjYxNzA5N30.7vb8kniEog1CE0zojEkuJh3k_XbYIKLd9gE_SmLUmrY", 
    D_CODE: "@MOGProtocol2026"
        };

        const db = window.supabase.createClient(CONFIG.U, CONFIG.K);

        window.onload = () => {
            const session = JSON.parse(localStorage.getItem('mog_session'));
            if (session) mountSession(session);
            loadMissions();
        };

        async function executeAuth() {
            const alias = document.getElementById('alias-in').value.trim().toUpperCase();
            const pass = document.getElementById('pass-in').value;
            if (!alias || !pass) return alert("REQUIRED: ALIAS & ACCESS_CODE");

            // Attempt to find operative
            let { data: operative, error } = await db.from('operatives').select('*').eq('alias', alias).maybeSingle();

            if (operative) {
                if (operative.password === pass) {
                    loginSuccess(operative);
                } else {
                    alert("ACCESS DENIED: INVALID BIOMETRICS");
                }
            } else {
                // New Registration
                const isDir = (pass === CONFIG.D_PASS);
                const { data: newOp, error: regError } = await db.from('operatives').insert([
                    { alias, password: pass, is_director: isDir }
                ]).select().single();
                
                if (regError) alert("REGISTRY ERROR: " + regError.message);
                else loginSuccess(newOp);
            }
        }

        function loginSuccess(op) {
            localStorage.setItem('mog_session', JSON.stringify(op));
            mountSession(op);
            db.from('operatives').update({ last_seen: new Date() }).eq('id', op.id);
        }

        function mountSession(op) {
            document.getElementById('auth-form').classList.add('hidden');
            document.getElementById('op-profile').classList.remove('hidden');
            document.getElementById('active-alias').innerText = op.alias;
            
            if (op.is_director) {
                document.getElementById('director-node').classList.remove('hidden');
                loadRegistry();
            }
        }

        async function loadMissions() {
            const { data: missions } = await db.from('missions').select('*').order('created_at', { ascending: false });
            const feed = document.getElementById('mission-feed');
            
            if (missions && missions.length > 0) {
                feed.innerHTML = missions.map(m => `
                    <div class="mission-card ${m.is_global_mandate ? 'border-red-500 bg-red-500/5' : ''}">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[9px] ${m.is_global_mandate ? 'text-red-500' : 'text-blue-400'} font-bold">
                                ${m.is_global_mandate ? 'MANDATE' : 'OPERATIVE_LOG'}
                            </span>
                            <span class="text-[9px] opacity-40">${new Date(m.created_at).toLocaleString()}</span>
                        </div>
                        <p class="text-sm text-white/90 leading-relaxed">${m.content}</p>
                    </div>
                `).join('');
            } else {
                feed.innerHTML = `<p class="text-xs opacity-30">NO ACTIVE MISSIONS IN SECTOR.</p>`;
            }
        }

        async function loadRegistry() {
            const { data: ops } = await db.from('operatives').select('alias, last_seen').order('last_seen', { ascending: false });
            document.getElementById('op-registry').innerHTML = ops.map(o => `
                <div class="flex justify-between py-2 border-b border-white/5">
                    <span class="text-white">${o.alias}</span>
                    <span class="opacity-40">${new Date(o.last_seen).toLocaleTimeString()}</span>
                </div>
            `).join('');
        }

        async function broadcastMandate() {
            const content = document.getElementById('dr-mandate').value;
            if (!content) return;

            const { error } = await db.from('missions').insert([
                { content: content, is_global_mandate: true }
            ]);

            if (!error) {
                document.getElementById('dr-mandate').value = '';
                loadMissions();
            }
        }

        function logout() {
            localStorage.removeItem('mog_session');
            location.reload();
        }
            // ... existing logout() function ...

        async function uploadToVault() {
            const fileInput = document.getElementById('media-upload');
            const file = fileInput.files[0];
            if (!file) return;

            const fileName = `${Date.now()}_${file.name}`;
            const { data, error } = await db.storage
                .from('intel-vault')
                .upload(fileName, file);

            if (error) {
                alert("UPLOAD ERROR: " + error.message);
            } else {
                alert("INTEL SECURED: " + fileName);
                location.reload(); 
            }
        }
    </script>
</body>
</html>
    
