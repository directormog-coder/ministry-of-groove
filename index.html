<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>M.O.G. | NATIONAL GRID MASTER TOTALITY V300</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        /* -----------------------------------------------------------
           1. QUANTUM THEME ENGINE & ATMOSPHERICS
        ----------------------------------------------------------- */
        @import url('https://api.fontshare.com/v2/css?f[]=clash-display@700&f[]=satoshi@400,900&display=swap');
        
        :root { 
            --mog-gold: #D4AF37; 
            --mog-blue: #00d4ff; 
            --mog-bg: #060a0f; 
            --mog-panel: rgba(10, 20, 30, 0.98); 
            --chat-sent: #005c4b; 
            --chat-received: #202c33;
            --id-gradient: linear-gradient(135deg, #0f172a 0%, #060a0f 100%);
        }

        /* LIQUID SCREEN SCALING */
        html, body { height: 100vh; width: 100vw; margin: 0; padding: 0; overflow: hidden; background-color: var(--mog-bg); }
        * { transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1); font-family: 'Satoshi', sans-serif; box-sizing: border-box; }

        body { 
            background-image: 
                linear-gradient(130deg, transparent 40%, rgba(0, 212, 255, 0.1) 45%, rgba(0, 212, 255, 0.18) 50%, rgba(0, 212, 255, 0.1) 55%, transparent 60%),
                radial-gradient(circle at 2px 2px, rgba(0, 212, 255, 0.15) 1px, transparent 0);
            background-size: 200% 200%, 40px 40px;
            animation: lightning-drift 20s linear infinite;
        }

        @keyframes lightning-drift { 0% { background-position: 0% 0%; } 100% { background-position: 100% 100%; } }

        /* SCROLLER CURSOR UI */
        .scroller-container::-webkit-scrollbar { width: 6px; }
        .scroller-container::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
        .scroller-container::-webkit-scrollbar-thumb { 
            background: linear-gradient(var(--mog-blue), var(--mog-gold)); 
            border-radius: 10px;
        }

        /* -----------------------------------------------------------
           2. TACTICAL GRID ARCHITECTURE
        ----------------------------------------------------------- */
        .liquid-grid {
            display: grid;
            height: calc(100vh - 80px);
            width: 100vw;
            padding: 15px;
            gap: 15px;
            grid-template-columns: repeat(3, 1fr);
            grid-template-areas: 
                "gateway messenger messenger"
                "gallery vault hitlist";
        }

        @media (max-width: 1024px) {
            .liquid-grid {
                grid-template-columns: 1fr;
                grid-template-areas: "gateway" "messenger" "gallery" "hitlist" "vault";
                overflow-y: auto; height: auto;
            }
            .scroller-container { height: 400px !important; }
        }

        .area-gateway { grid-area: gateway; }
        .area-messenger { grid-area: messenger; }
        .area-gallery { grid-area: gallery; }
        .area-vault { grid-area: vault; }
        .area-hitlist { grid-area: hitlist; }

        .command-tile { 
            background: var(--mog-panel); border: 1px solid rgba(0, 212, 255, 0.2); 
            backdrop-filter: blur(50px); border-radius: 35px; overflow: hidden;
            display: flex; flex-direction: column; box-shadow: 0 30px 60px rgba(0,0,0,0.8);
        }

        /* 2X3 MATRIX ENGINE */
        .matrix-grid { display: grid; grid-template-columns: repeat(2, 1fr); grid-auto-rows: 140px; gap: 12px; }
        .scroller-container { height: 100%; overflow-y: scroll; padding: 15px; flex-grow: 1; }

        /* HAMBURGER DRAWER */
        #side-drawer { 
            position: fixed; top: 0; left: -100%; width: 340px; height: 100%; 
            background: #0a0e14; z-index: 9999; transition: 0.5s; 
            border-right: 1px solid var(--mog-blue);
        }
        #side-drawer.drawer-active { left: 0; }
        .drawer-item { padding: 18px 30px; border-bottom: 1px solid rgba(255,255,255,0.03); text-transform: uppercase; font-size: 11px; font-weight: 900; color: #666; display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .drawer-item:hover { background: rgba(0, 212, 255, 0.05); color: white; }

        /* IDENTITY MATRIX */
        .id-card { background: var(--id-gradient); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 24px; padding: 20px; display: flex; align-items: center; gap: 15px; }
        .device-mobile .id-card { flex-direction: column; text-align: center; }
        .id-avatar { width: 85px; height: 85px; border-radius: 50%; border: 3px solid var(--mog-gold); }

        /* AUTH UI */
        .auth-input { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1); border-radius: 18px; padding: 15px; width: 100%; color: white; margin-bottom: 10px; font-size: 13px; outline: none; }
        .auth-btn { background: #fff; color: #000; font-weight: 900; border-radius: 50px; padding: 16px; width: 100%; text-transform: uppercase; cursor: pointer; letter-spacing: 2px; font-size: 11px; }
    </style>
</head>
<body id="mog-mainframe">

    <audio id="log-drum" src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logdrum.mp3" preload="auto"></audio>

    <nav id="side-drawer">
        <div class="p-8 border-b border-white/5 flex justify-between items-center">
            <img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" class="h-12 w-12">
            <button onclick="toggleDrawer()"><i class="fa-solid fa-xmark text-white"></i></button>
        </div>
        <div class="overflow-y-auto h-full pb-20">
            <p class="px-8 py-6 text-[9px] text-gold font-black uppercase tracking-widest">Mainframe Directories</p>
            <div class="drawer-item"><i class="fa-solid fa-house-chimney"></i> National Grid Home</div>
            <div class="drawer-item"><i class="fa-solid fa-id-card-clip"></i> Operative ID Matrix</div>
            <div class="drawer-item"><i class="fa-solid fa-file-audio"></i> Mandate Mix Archive</div>
            <div class="drawer-item"><i class="fa-solid fa-file-lines"></i> Tracklist Metadata</div>
            <div class="drawer-item" onclick="toggleUI('director-console')"><i class="fa-solid fa-user-gear"></i> Director Hub</div>
            <div class="drawer-item"><i class="fa-solid fa-shield-virus"></i> Security Protocol</div>
            <div class="drawer-item"><i class="fa-solid fa-database"></i> Supabase Sync</div>
        </div>
    </nav>

    <header class="h-[80px] px-8 flex justify-between items-center border-b border-white/5 bg-black/40">
        <div class="flex items-center gap-5">
            <button onclick="toggleDrawer()" class="text-gold text-2xl"><i class="fa-solid fa-bars-staggered"></i></button>
            <img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" class="h-12 w-12" id="mog-logo-trigger">
            <div>
                <h1 class="text-xl font-black uppercase italic tracking-tighter text-gold">Ministry of Groove</h1>
                <p class="text-[10px] text-zinc-500 font-black uppercase italic tracking-widest">Decipher the culture.</p>
            </div>
        </div>
        <div class="hidden md:flex items-center gap-6">
            <button onclick="operativePulse()" class="bg-blue-500 text-black font-black uppercase text-[10px] px-6 py-2 rounded-full shadow-lg shadow-blue-500/30">Operative Pulse</button>
        </div>
    </header>

    <div class="liquid-grid">
        
        <section class="command-tile area-gateway p-8">
            <div id="auth-fields" class="w-full">
                <p class="text-[10px] text-gold font-black uppercase mb-6 border-b border-gold/20 pb-2 italic text-center">Identity Portal</p>
                <input id="login-user" type="text" placeholder="GMAIL / ALIAS" class="auth-input">
                <input id="login-pass" type="password" placeholder="PASSCODE" class="auth-input">
                <button onclick="handleMainAuth()" class="auth-btn mt-4">Authorize</button>
            </div>
            <div id="active-op-badge" class="hidden w-full h-full flex flex-col justify-center">
                <div class="id-card">
                    <img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" class="id-avatar">
                    <div class="text-left">
                        <p class="text-[8px] text-gold font-black uppercase">National Grid OP</p>
                        <h2 id="display-op-id" class="text-2xl text-white font-black uppercase italic tracking-tighter">OPERATIVE</h2>
                        <button onclick="logout()" class="text-[8px] text-red-500 font-black uppercase mt-2">Terminate Session</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="command-tile area-messenger">
            <div class="flex-grow flex flex-col bg-[#0b141a] m-1 rounded-[30px] overflow-hidden">
                <div id="chat-stream" class="flex-grow p-6 overflow-y-auto space-y-4 scrollbar-hide"></div>
                <div class="bg-[#202c33] p-4 flex gap-4 items-center">
                    <input type="text" id="chat-msg" placeholder="Encode message..." class="flex-grow bg-[#2a3942] border-0 rounded-full px-6 py-4 text-xs text-white outline-none">
                    <button onclick="sendMessage()" class="w-14 h-14 bg-blue-500 text-black rounded-full flex items-center justify-center hover:scale-110 shadow-2xl"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </div>
        </section>

        <section class="command-tile area-gallery">
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-black/20">
                <p class="text-[10px] text-white font-black uppercase italic">Visual Archive</p>
                <i class="fa-solid fa-video text-blue-400"></i>
            </div>
            <div class="scroller-container">
                <div class="matrix-grid" id="gallery-matrix"></div>
            </div>
        </section>

        <section class="command-tile area-vault">
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-black/20">
                <p class="text-[10px] text-white font-black uppercase italic">Mandate Vault</p>
                <i class="fa-solid fa-file-audio text-gold"></i>
            </div>
            <div class="scroller-container">
                <div class="matrix-grid" id="vault-matrix"></div>
                <div class="p-4 mt-auto border-t border-white/5 bg-black/40">
                    <audio id="vault-player" controls class="w-full h-8" src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/mandatemix.mp3"></audio>
                </div>
            </div>
        </section>

        <section class="command-tile area-hitlist">
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-black/20">
                <p class="text-[10px] text-white font-black uppercase italic">Hitlist status</p>
                <i class="fa-brands fa-spotify text-[#1DB954]"></i>
            </div>
            <div class="scroller-container">
                <div class="matrix-grid" id="hitlist-matrix"></div>
                <div class="p-4 mt-auto border-t border-white/5 bg-black/40">
                    <iframe src="https://open.spotify.com/embed/playlist/37i9dQZF1DX6G98mP9P2Br" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
                </div>
            </div>
        </section>
        
    </div>

    <div id="director-console" style="display:none;" class="fixed inset-0 z-[10000] bg-black/98 flex items-center justify-center p-6">
        <div class="command-tile p-12 max-w-4xl w-full border-gold/40">
            <h2 class="text-3xl text-white font-black uppercase italic mb-8 border-b border-white/5 pb-4">Director Suite</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                <button onclick="triggerManualPulse()" class="bg-blue-500 text-black font-black uppercase p-8 rounded-[40px] text-xs shadow-2xl">Broadcast Pulse</button>
                <div class="bg-white/5 p-8 rounded-[40px] border border-white/10 text-center flex flex-col justify-center">
                    <p class="text-[10px] text-gold font-black uppercase mb-2">System Slogan</p>
                    <p class="text-xl text-white font-black italic uppercase">Decipher the culture.</p>
                </div>
            </div>
            <button onclick="toggleUI('director-console')" class="text-xs text-zinc-600 uppercase font-black w-full text-center">Terminate Session</button>
        </div>
    </div>

    <script>
        const MOG_CFG = {
            U: "https://vbkpatwvgvwarybbpiky.supabase.co",
            K: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZia3BhdHd2Z3Z3YXJpYmJwaWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExMjc0MTksImV4cCI6MjA4NjcwMzQxOX0.v3iWw2z9vL-X6pGjY0W_S5m1z0S8uI1L8yN7fL0M_Y8"
        };
        const db = window.supabase.createClient(MOG_CFG.U, MOG_CFG.K);
        let currentOp = null, logoClicks = 0;

        function toggleDrawer() { document.getElementById('side-drawer').classList.toggle('drawer-active'); }
        function toggleUI(id) { 
            const el = document.getElementById(id);
            el.style.display = el.style.display === 'none' ? 'flex' : 'none'; 
        }

        async function operativePulse() {
            document.body.style.opacity = '0.7';
            document.getElementById('log-drum').play();
            setTimeout(() => document.body.style.opacity = '1', 300);
        }

        /* MATRIX CONTENT ENGINE */
        function initMatrix() {
            const gal = document.getElementById('gallery-matrix');
            const vlt = document.getElementById('vault-matrix');
            const hit = document.getElementById('hitlist-matrix');

            for(let i=1; i<=6; i++) {
                gal.innerHTML += `<div class="bg-white/5 border border-white/10 rounded-2xl flex items-center justify-center overflow-hidden"><video muted loop class="w-full h-full object-cover" src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/clip${i}.mp4" onclick="this.play()"></video></div>`;
                vlt.innerHTML += `<div class="bg-white/5 border border-white/10 rounded-2xl flex flex-col items-center justify-center p-4"><i class="fa-solid fa-compact-disc text-gold text-2xl mb-2"></i><p class="text-[8px] text-white font-black">MANDATE_S0${i}</p><button onclick="document.getElementById('vault-player').play()" class="text-[7px] bg-gold text-black px-3 py-1 rounded mt-2 uppercase font-black">Play</button></div>`;
            }
            for(let i=1; i<=10; i++) {
                hit.innerHTML += `<div class="bg-white/5 border border-white/10 rounded-2xl flex flex-col items-center justify-center p-4"><img src="https://raw.githubusercontent.com/directormog-coder/Ministry-of-Groove/main/logo.png" class="w-8 h-8 rounded-lg mb-2 grayscale"><p class="text-[7px] text-white font-black uppercase">HIT_RANK_${i}</p></div>`;
            }
        }

        /* SUPABASE REALTIME */
        const channel = db.channel('public:messages')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, (payload) => {
                document.getElementById('log-drum').currentTime = 0;
                document.getElementById('log-drum').play().catch(() => {});
                appendMsg(payload.new); 
            }).subscribe();

        function appendMsg(m) {
            const stream = document.getElementById('chat-stream');
            const div = document.createElement('div');
            div.className = `bubble ${m.user_id === currentOp?.id ? 'sent' : 'received'}`;
            div.innerHTML = `<span class="text-[8px] font-black uppercase block mb-1 text-gold">@${m.alias}</span>${m.content}`;
            stream.appendChild(div);
            stream.scrollTop = stream.scrollHeight;
        }

        async function handleMainAuth() {
            const email = document.getElementById('login-user').value.trim();
            const pass = document.getElementById('login-pass').value;
            const { data, error } = await db.auth.signInWithPassword({ 
                email: email.includes('@') ? email : `${email}@user.mog.internal`, 
                password: pass 
            });
            if(!error) { 
                currentOp = data.user; 
                document.getElementById('auth-fields').classList.add('hidden');
                document.getElementById('active-op-badge').classList.remove('hidden');
                const { data: reg } = await db.from('registrations').select('alias').eq('user_id', currentOp.id).single();
                if(reg) document.getElementById('display-op-id').innerText = reg.alias;
            } else { alert(error.message); }
        }

        document.getElementById('mog-logo-trigger').addEventListener('click', () => {
            if (++logoClicks === 5) { toggleUI('director-console'); logoClicks = 0; }
            setTimeout(() => logoClicks = 0, 5000);
        });

        window.onload = () => { 
            initMatrix();
            const isMobile = /Android|iPhone/i.test(navigator.userAgent);
            document.getElementById('mog-mainframe').classList.add(isMobile ? 'device-mobile' : 'device-pc');
        };
    </script>
</body>
</html>
