name: Grid_Upgrade_Protocol

on:
  push:
    branches: [ main ]

jobs:
  upgrade:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout_Source
        uses: actions/checkout@v3

      - name: Cache_Bust_Service_Worker
        run: |
          # Automatically updates the CACHE_NAME version in service-worker.js
          sed -i "const CACHE_NAME = 'mog-absolute-$(date +%s)';" service-worker.js
          
      - name: Git_Auto_Commit_Version
        run: |
          git config --global user.name 'MOG-Director-Bot'
          git config --global user.email 'director@ministryofgroove.rsa'
          git add service-worker.js
          git commit -m "SYSTEM_UPGRADE: $(date +'%Y-%m-%d %H:%M:%S')" || echo "No changes to commit"
          git push
          
